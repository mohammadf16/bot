(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1066],{6039:function(e,t,a){Promise.resolve().then(a.bind(a,8970))},8970:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return E}});var s=a(7437),r=a(29),l=a.n(r),n=a(2265),i=a(9653),o=a(4072),c=a(9799),d=a(2023),x=a(1804),u=a(1239),b=a(1706),f=a(8623),m=a(6595),h=a(2451),g=a(6337),p=a(9474),j=a(9322),v=a(5621),w=a(5186),y=a(9235),N=a(1837),k=a(7766);let _=e=>e.toLocaleString("fa-IR"),S=["#F43F5E","#8B5CF6","#0EA5E9","#10B981","#F59E0B","#EC4899","#6366F1","#14B8A6"],C=e=>{let{index:t,total:a,segment:r}=e,l=360/a,n=t*l,i=Math.PI/180*(n-90),o=Math.PI/180*(n+l-90),c="M ".concat(50," ").concat(50," L ").concat(50+50*Math.cos(i)," ").concat(50+50*Math.sin(i)," A ").concat(50," ").concat(50," 0 0 1 ").concat(50+50*Math.cos(o)," ").concat(50+50*Math.sin(o)," Z"),d=n-90+l/2,x=(d+360)%360,u=x>90&&x<270;return(0,s.jsxs)("g",{className:"hover:opacity-90 transition-opacity",children:[(0,s.jsx)("path",{d:c,fill:r.color,stroke:"rgba(255,255,255,0.15)",strokeWidth:"0.5"}),(0,s.jsxs)("g",{transform:"rotate(".concat(d,", ").concat(50,", ").concat(50,")"),children:[(0,s.jsx)("text",{x:82,y:50,fill:"white",textAnchor:"middle",dominantBaseline:"middle",transform:u?"rotate(180, ".concat(82,", ").concat(50,")"):void 0,style:{fontSize:"3.5px",fontWeight:800,fontFamily:"var(--font-sans)",filter:"drop-shadow(0px 1px 2px rgba(0,0,0,0.5))"},children:r.label.length>15?r.label.substring(0,14)+"..":r.label}),r.weight>0&&r.weight<5&&(0,s.jsx)("text",{x:82,y:55,fontSize:"3px",textAnchor:"middle",transform:u?"rotate(180, ".concat(82,", ").concat(55,")"):void 0,children:"⭐"})]})]})};function E(){var e,t;let{user:a,refreshMe:r,isAuthenticated:E}=(0,k.a)(),A=(0,i._)(),[T,I]=(0,n.useState)(null),[P,z]=(0,n.useState)([]),[Z,F]=(0,n.useState)(!1),[O,B]=(0,n.useState)(null),[M,D]=(0,n.useState)(0),[R,L]=(0,n.useState)(!0),[J,U]=(0,n.useState)("normal"),[G,H]=(0,n.useState)(null),W=(0,n.useRef)(null),X=(0,n.useRef)(null);(0,n.useEffect)(()=>{W.current=new Audio("/sounds/spin.mp3"),X.current=new Audio("/sounds/win.mp3"),W.current&&(W.current.volume=.5),X.current&&(X.current.volume=.6)},[]);let Y=(0,n.useCallback)(async()=>{try{var e,t,a;let[s,r]=await Promise.all([(0,N.Nv)("/wheel/config",{method:"GET"},{auth:!1}),E?(0,N.Nv)("/wheel/history",{method:"GET"}):Promise.resolve({items:[]})]);H(s.tiers);let l=null==s?void 0:null===(e=s.tiers)||void 0===e?void 0:e[J],n=((null==l?void 0:l.segments)||(null==s?void 0:null===(t=s.config)||void 0===t?void 0:t.segments)||[{label:"100 سکه",weight:10},{label:"پوچ",weight:10},{label:"5000 تومان",weight:5},{label:"آیفون 13",weight:1},{label:"گردونه رایگان",weight:10},{label:"20 امتیاز",weight:10}]).map((e,t)=>({...e,color:e.color||S[t%S.length]}));I({wheelCostChances:(null==l?void 0:l.costAmount)||(null==s?void 0:null===(a=s.config)||void 0===a?void 0:a.wheelCostChances)||1,segments:n}),(null==r?void 0:r.items)&&z(r.items)}catch(e){console.error(e),w.ZP.error("خطا در دریافت اطلاعات گردونه")}},[E,J]);(0,n.useEffect)(()=>{Y()},[Y]);let q=null!==(e=null==a?void 0:a.chances)&&void 0!==e?e:0,K=null!==(t=null==a?void 0:a.walletBalance)&&void 0!==t?t:0,Q=null==G?void 0:G[J],V=(0,n.useMemo)(()=>!!T&&!!E&&!Z&&null!=Q&&!!Q.enabled&&("IRR"===Q.costAsset?K>=Q.costAmount:q>=Q.costAmount),[T,E,Z,Q,K,q]),$=async()=>{if(V&&T){F(!0),B(null),R&&W.current&&(W.current.currentTime=0,W.current.loop=!0,W.current.play().catch(()=>{}));try{let{result:e}=await (0,N.Nv)("/wheel/spin",{method:"POST",body:JSON.stringify({tier:J})}),t=T.segments.length,a=360/t,s=T.segments.findIndex(t=>t.label===e.label),l=.8*a,n=M+1800+(360-((-1!==s?s:0)*a+a/2))+(Math.random()*l-l/2);await A.start({rotate:n,transition:{duration:5,ease:[.15,0,.15,1]}}),D(n),B(e),R&&(W.current&&(W.current.pause(),W.current.currentTime=0),X.current&&e.win&&X.current.play().catch(()=>{})),e.win?((0,y.Z)({particleCount:150,spread:80,origin:{y:.6},colors:["#F59E0B","#EC4899","#10B981"],zIndex:9999}),w.ZP.success("تبریک! برنده ".concat(e.label," شدید"),{icon:"\uD83C\uDF89",style:{background:"#10B981",color:"#fff"}})):w.ZP.error("متاسفانه پوچ بود!",{icon:"\uD83D\uDE22"}),await r(),await Y()}catch(e){w.ZP.error(e instanceof Error?e.message:"خطا در برقراری ارتباط با سرور"),R&&W.current&&W.current.pause()}finally{F(!1)}}};return(0,s.jsxs)("main",{dir:"rtl",className:"jsx-1447eea82eb974f7 min-h-screen bg-[#050505] text-white pt-24 pb-20 overflow-x-hidden relative",children:[(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 fixed inset-0 pointer-events-none",children:[(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 absolute top-[-20%] left-[-10%] w-[800px] h-[800px] bg-purple-900/20 blur-[150px] rounded-full mix-blend-screen"}),(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 absolute bottom-[-20%] right-[-10%] w-[800px] h-[800px] bg-blue-900/20 blur-[150px] rounded-full mix-blend-screen"}),(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 absolute inset-0 bg-[url('/grid.svg')] opacity-[0.03]"})]}),(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 max-w-6xl mx-auto px-4 relative z-10 space-y-12",children:[(0,s.jsxs)("header",{className:"jsx-1447eea82eb974f7 bg-white/5 backdrop-blur-xl border border-white/10 p-4 md:p-6 rounded-3xl relative overflow-hidden shadow-2xl",children:[(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-purple-500 to-transparent opacity-50"}),(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 flex flex-col md:flex-row md:items-center justify-between gap-6 relative z-10",children:[(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 flex items-center gap-5",children:[(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 w-14 h-14 bg-gradient-to-br from-violet-600 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg shadow-violet-500/20 rotate-3 shrink-0 ring-1 ring-white/20",children:(0,s.jsx)(d.Z,{className:"text-white w-7 h-7"})}),(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7",children:[(0,s.jsx)("h1",{className:"jsx-1447eea82eb974f7 text-2xl md:text-3xl font-black tracking-tight text-white bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400",children:"گردونه شانس"}),(0,s.jsx)("p",{className:"jsx-1447eea82eb974f7 text-white/40 text-sm font-medium mt-1",children:"شانس خودت رو برای جوایز میلیونی امتحان کن"})]})]}),(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 flex flex-wrap items-center gap-3",children:[(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 h-12 px-5 rounded-2xl bg-[#0F0F11] border border-white/5 flex items-center gap-3 shadow-inner",children:[(0,s.jsx)(x.Z,{className:"text-emerald-400 w-5 h-5"}),(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 flex flex-col",children:[(0,s.jsx)("span",{className:"jsx-1447eea82eb974f7 text-[10px] text-gray-500 font-bold uppercase tracking-wider",children:"موجودی"}),(0,s.jsx)("span",{className:"jsx-1447eea82eb974f7 font-mono font-bold text-white",children:_(K)})]})]}),(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 h-12 px-5 rounded-2xl bg-amber-500/10 border border-amber-500/20 flex items-center gap-3",children:[(0,s.jsx)(u.Z,{className:"text-amber-500 w-5 h-5 animate-pulse"}),(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 flex flex-col",children:[(0,s.jsx)("span",{className:"jsx-1447eea82eb974f7 text-[10px] text-amber-500/60 font-bold uppercase tracking-wider",children:"شانس"}),(0,s.jsx)("span",{className:"jsx-1447eea82eb974f7 font-mono font-bold text-amber-500 text-lg",children:q.toLocaleString("fa-IR")})]})]}),(0,s.jsx)("button",{onClick:()=>L(!R),className:"jsx-1447eea82eb974f7 w-12 h-12 rounded-2xl bg-[#0F0F11] border border-white/5 flex items-center justify-center hover:bg-white/5 transition-colors shrink-0 text-white/50 hover:text-white",children:R?(0,s.jsx)(b.Z,{className:"w-5 h-5"}):(0,s.jsx)(f.Z,{className:"w-5 h-5"})})]})]}),(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 mt-4 grid grid-cols-3 gap-2 md:gap-3",children:["normal","gold","jackpot"].map(e=>{var t,a,r;let l=J===e,n=null==G?void 0:G[e];return(0,s.jsxs)("button",{onClick:()=>U(e),className:"jsx-1447eea82eb974f7 "+"rounded-2xl border px-3 py-2 text-right transition ".concat(l?"border-violet-400 bg-violet-500/10":"border-white/10 bg-[#0F0F11]"),children:[(0,s.jsx)("p",{className:"jsx-1447eea82eb974f7 text-sm font-black",children:"normal"===e?"گردونه معمولی":"gold"===e?"گردونه طلایی":"گردونه جکپات"}),(0,s.jsxs)("p",{className:"jsx-1447eea82eb974f7 text-[11px] text-white/50 mt-1",children:["هزینه: ",(null!==(a=null!==(t=null==n?void 0:n.costAmount)&&void 0!==t?t:null==T?void 0:T.wheelCostChances)&&void 0!==a?a:0).toLocaleString("fa-IR")," ",null!==(r=null==n?void 0:n.costAsset)&&void 0!==r?r:"CHANCE"]}),n&&!n.enabled?(0,s.jsx)("p",{className:"jsx-1447eea82eb974f7 text-[10px] text-rose-400 mt-1",children:"غیرفعال"}):null]},e)})})]}),(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 grid lg:grid-cols-[1fr,380px] gap-12 items-start",children:[(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 flex flex-col items-center justify-center",children:[(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 relative w-full max-w-[420px] aspect-square mx-auto mb-12 group",children:[(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 absolute inset-0 bg-gradient-to-tr from-violet-600/20 to-fuchsia-600/20 rounded-full blur-[60px] animate-pulse"}),(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 w-full h-full relative z-10 p-2",children:[(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 absolute inset-0 rounded-full bg-[#18181b] shadow-2xl border-[12px] border-[#27272a] ring-1 ring-white/5"}),(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 absolute inset-3 rounded-full border border-dashed border-white/10"}),[...Array(12)].map((e,t)=>(0,s.jsx)("div",{style:{transformOrigin:"center ".concat(210,"px"),transform:"rotate(".concat(30*t,"deg)")},className:"jsx-1447eea82eb974f7 absolute w-1.5 h-1.5 bg-white/30 rounded-full top-0 left-1/2 -ml-[3px]"},t)),(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 absolute -top-6 left-1/2 -translate-x-1/2 z-30 filter drop-shadow-[0_0_10px_rgba(234,179,8,0.5)]",children:(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 w-10 h-12 bg-[#09090b] clip-path-marker flex flex-col items-center pt-1 border-t-4 border-amber-500",children:[(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 w-2 h-2 bg-amber-500 rounded-full shadow-[0_0_10px_#f59e0b]"}),(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 w-0.5 h-full bg-gradient-to-b from-amber-500/50 to-transparent mt-1"})]})}),(0,s.jsx)(o.E.div,{className:"w-full h-full relative rounded-full overflow-hidden border-[6px] border-[#09090b] shadow-[inset_0_0_20px_rgba(0,0,0,0.8)]",animate:A,initial:{rotate:0},style:{transformOrigin:"center"},children:T?(0,s.jsxs)("svg",{viewBox:"0 0 100 100",style:{filter:"drop-shadow(0 0 5px rgba(0,0,0,0.3))"},className:"jsx-1447eea82eb974f7 w-full h-full",children:[(0,s.jsx)("circle",{cx:"50",cy:"50",r:"50",fill:"#18181b",className:"jsx-1447eea82eb974f7"}),T.segments.map((e,t)=>(0,s.jsx)(C,{index:t,total:T.segments.length,segment:e},t))]}):(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 w-full h-full bg-[#18181b] animate-pulse rounded-full flex items-center justify-center",children:(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 w-16 h-16 border-2 border-white/10 border-t-violet-500 rounded-full animate-spin"})})}),(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-20 h-20 bg-[#18181b] rounded-full shadow-[0_10px_20px_rgba(0,0,0,0.5)] border-4 border-[#27272a] flex items-center justify-center z-20",children:(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 w-14 h-14 bg-gradient-to-br from-[#27272a] to-[#09090b] rounded-full flex items-center justify-center shadow-inner relative overflow-hidden",children:[(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 absolute inset-0 bg-[url('/noise.png')] opacity-20"}),(0,s.jsx)(m.Z,{className:"w-6 h-6 text-amber-500 fill-amber-500 animate-pulse"})]})})]})]}),(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 relative z-20 w-full max-w-[280px]",children:E?(0,s.jsxs)("button",{onClick:$,disabled:!V,className:"jsx-1447eea82eb974f7 \n                    w-full relative group py-5 rounded-2xl font-black text-xl overflow-hidden shadow-[0_10px_40px_-10px_rgba(139,92,246,0.3)]\n                    transition-all duration-300 hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none\n                  ",children:[(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 absolute inset-0 bg-gradient-to-r from-violet-600 via-fuchsia-600 to-violet-600 animate-gradient-xy"}),(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 absolute inset-[2px] bg-[#09090b] rounded-[14px] flex items-center justify-center z-10"}),(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 relative z-20 flex flex-col items-center justify-center gap-1",children:[(0,s.jsxs)("span",{className:"jsx-1447eea82eb974f7 flex items-center gap-2 text-white group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-violet-400 group-hover:to-fuchsia-400 transition-all",children:[Z?"در حال چرخش...":"شروع چرخش",!Z&&(0,s.jsx)(h.Z,{className:"w-5 h-5 group-hover:-translate-x-1 transition-transform text-white"})]}),!Z&&T&&(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 text-[11px] font-mono text-gray-400 mt-0.5",children:["هزینه: ",(0,s.jsxs)("span",{className:"jsx-1447eea82eb974f7 text-violet-400",children:[T.wheelCostChances," شانس"]})]})]})]}):(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 bg-[#18181b] border border-white/5 p-5 rounded-2xl text-center shadow-lg",children:[(0,s.jsx)(g.Z,{className:"w-6 h-6 text-gray-500 mx-auto mb-2"}),(0,s.jsx)("p",{className:"jsx-1447eea82eb974f7 text-gray-400 text-sm",children:"لطفاً برای شرکت در بازی وارد شوید"})]})})]}),(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 space-y-6",children:[(0,s.jsx)(c.M,{mode:"wait",children:O&&(0,s.jsx)(o.E.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,scale:.95},className:"p-6 rounded-3xl relative overflow-hidden text-center border shadow-lg ".concat(O.win?"bg-[#0f1d16] border-emerald-500/20":"bg-[#1f1212] border-red-500/20"),children:(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 relative z-10",children:[O.win?(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 w-12 h-12 bg-emerald-500/10 rounded-full flex items-center justify-center mx-auto mb-3 ring-1 ring-emerald-500/20",children:(0,s.jsx)(p.Z,{className:"w-6 h-6 text-emerald-400"})}):(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 w-12 h-12 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-3 ring-1 ring-red-500/20",children:(0,s.jsx)(j.Z,{className:"w-6 h-6 text-red-400"})}),(0,s.jsx)("h3",{className:"jsx-1447eea82eb974f7 "+"font-bold text-xs uppercase tracking-widest mb-1 ".concat(O.win?"text-emerald-400":"text-red-400"),children:O.win?"تبریک!":"متاسفانه"}),(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 text-2xl md:text-3xl font-black text-white",children:O.label})]})})}),(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 bg-[#0F0F11] border border-white/5 rounded-3xl overflow-hidden flex flex-col h-[500px] shadow-xl",children:[(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 p-5 border-b border-white/5 bg-white/[0.02] flex items-center justify-between shrink-0",children:[(0,s.jsxs)("h3",{className:"jsx-1447eea82eb974f7 font-bold flex items-center gap-2 text-gray-200",children:[(0,s.jsx)(v.Z,{className:"text-violet-500 w-5 h-5"}),"تاریخچه چرخش‌ها"]}),(0,s.jsx)("span",{className:"jsx-1447eea82eb974f7 text-xs bg-white/5 px-2.5 py-1 rounded-lg text-gray-400 font-mono",children:P.length})]}),(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar",children:0===P.length?(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 h-full flex flex-col items-center justify-center text-gray-600 gap-3",children:[(0,s.jsx)(v.Z,{className:"w-10 h-10 opacity-20"}),(0,s.jsx)("span",{className:"jsx-1447eea82eb974f7 text-sm",children:"هنوز چرخشی انجام نداده‌اید"})]}):P.map((e,t)=>(0,s.jsxs)(o.E.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.05*t},className:"p-3.5 rounded-2xl bg-[#18181b] hover:bg-[#202024] border border-white/5 transition-all group flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"jsx-1447eea82eb974f7 flex flex-col gap-1",children:[(0,s.jsx)("span",{className:"jsx-1447eea82eb974f7 font-bold text-sm text-gray-300 group-hover:text-white transition-colors",children:e.label}),(0,s.jsx)("span",{className:"jsx-1447eea82eb974f7 text-[10px] text-gray-600 font-medium font-mono",children:e.createdAt?new Date(e.createdAt).toLocaleTimeString("fa-IR"):"--:--"})]}),(0,s.jsx)("div",{className:"jsx-1447eea82eb974f7 "+"\n                            px-2.5 py-1 rounded-lg text-[10px] font-bold border \n                            ".concat(e.win?"bg-emerald-500/5 border-emerald-500/10 text-emerald-500":"bg-red-500/5 border-red-500/10 text-red-500","\n                        "),children:e.win?"بـرد":"باخت"})]},e.id||t))})]})]})]})]}),(0,s.jsx)(l(),{id:"1447eea82eb974f7",children:".clip-path-marker{-webkit-clip-path:polygon(0%0%,100%0%,50%100%);clip-path:polygon(0%0%,100%0%,50%100%)}.custom-scrollbar::-webkit-scrollbar{width:4px}.custom-scrollbar::-webkit-scrollbar-track{background:rgba(255,255,255,.02)}.custom-scrollbar::-webkit-scrollbar-thumb{background:#27272a;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px}.custom-scrollbar::-webkit-scrollbar-thumb:hover{background:#3f3f46}@-webkit-keyframes gradient-xy{0%,100%{background-position:0%50%}50%{background-position:100%50%}}@-moz-keyframes gradient-xy{0%,100%{background-position:0%50%}50%{background-position:100%50%}}@-o-keyframes gradient-xy{0%,100%{background-position:0%50%}50%{background-position:100%50%}}@keyframes gradient-xy{0%,100%{background-position:0%50%}50%{background-position:100%50%}}.animate-gradient-xy{-webkit-background-size:200%200%;-moz-background-size:200%200%;-o-background-size:200%200%;background-size:200%200%;-webkit-animation:gradient-xy 3s ease infinite;-moz-animation:gradient-xy 3s ease infinite;-o-animation:gradient-xy 3s ease infinite;animation:gradient-xy 3s ease infinite}"})]})}},1837:function(e,t,a){"use strict";a.d(t,{Je:function(){return x},Nv:function(){return f},c8:function(){return m},hP:function(){return c},vD:function(){return d}});var s,r=a(257);let l=null!==(s=r.env.NEXT_PUBLIC_API_URL)&&void 0!==s?s:"http://localhost:4000/api/v1",n=r.env.NEXT_PUBLIC_API_GATEWAY_KEY,i="car_access_token",o="car_refresh_token";function c(){return localStorage.getItem(i)}function d(e){localStorage.setItem(i,e.accessToken),localStorage.setItem(o,e.refreshToken)}function x(){localStorage.removeItem(i),localStorage.removeItem(o)}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0,s=new Headers(t.headers);void 0!==t.body&&null!==t.body&&s.set("Content-Type","application/json"),n&&s.set("x-api-gateway-key",n),a&&s.set("Authorization","Bearer ".concat(a));let r=await fetch("".concat(l).concat(e),{...t,headers:s});if(!r.ok){var i,o;let e=await r.json().catch(()=>({}));throw Error(null!==(o=null!==(i=e.error)&&void 0!==i?i:e.message)&&void 0!==o?o:"HTTP_".concat(r.status))}return 204===r.status?{}:await r.json()}async function b(){let e=localStorage.getItem(o);if(!e)return null;try{let t=await u("/auth/refresh",{method:"POST",body:JSON.stringify({refreshToken:e})});return d(t),t.accessToken}catch(e){return x(),null}}async function f(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{auth:!0},r=null===(t=s.auth)||void 0===t||t,l=r?c():void 0;try{return await u(e,a,null!=l?l:void 0)}catch(s){if(!r)throw s;let t=await b();if(!t)throw s;return u(e,a,t)}}function m(){return"undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():"idemp-".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2))}},7766:function(e,t,a){"use strict";a.d(t,{H:function(){return o},a:function(){return c}});var s=a(7437),r=a(2265),l=a(1837);let n=(0,r.createContext)(null);async function i(){return(0,l.Nv)("/me",{method:"GET"},{auth:!0})}function o(e){let{children:t}=e,[a,o]=(0,r.useState)(null),[c,d]=(0,r.useState)(!0),x=(0,r.useCallback)(async()=>{o(await i())},[]);(0,r.useEffect)(()=>{let e=!0;return(async()=>{try{let t=await i();e&&o(t)}catch(t){e&&o(null)}finally{e&&d(!1)}})(),()=>{e=!1}},[]);let u=(0,r.useCallback)(async e=>{let{email:t,password:a}=e,s=await (0,l.Nv)("/auth/login",{method:"POST",body:JSON.stringify({email:t,password:a})},{auth:!1});return(0,l.vD)({accessToken:s.accessToken,refreshToken:s.refreshToken}),o(s.user),s.user},[]),b=(0,r.useCallback)(async e=>{let{email:t,password:a,referralCode:s}=e;await (0,l.Nv)("/auth/register",{method:"POST",body:JSON.stringify({email:t,password:a,referralCode:s})},{auth:!1})},[]),f=(0,r.useCallback)(async()=>{try{let e=localStorage.getItem("car_refresh_token");e&&await (0,l.Nv)("/auth/logout",{method:"POST",body:JSON.stringify({refreshToken:e})})}catch(e){}finally{(0,l.Je)(),o(null)}},[]),m=(0,r.useMemo)(()=>({user:a,isLoading:c,isAuthenticated:!!a,login:u,register:b,logout:f,refreshMe:x}),[a,c,u,b,f,x]);return(0,s.jsx)(n.Provider,{value:m,children:t})}function c(){let e=(0,r.useContext)(n);if(!e)throw Error("useAuth must be used within AuthProvider");return e}}},function(e){e.O(0,[5186,4072,3293,2971,2117,1744],function(){return e(e.s=6039)}),_N_E=e.O()}]);