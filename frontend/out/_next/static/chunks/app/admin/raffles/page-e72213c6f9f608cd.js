(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[135],{9447:function(e,t,s){Promise.resolve().then(s.bind(s,1546))},1546:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return i}});var a=s(7437),r=s(4072),c=s(2265),l=s(5186),n=s(1837);function i(){let[e,t]=(0,c.useState)(!1),[s,i]=(0,c.useState)({title:"",maxTickets:"1000"}),[d,o]=(0,c.useState)([]),x=async()=>{try{let e=await (0,n.Nv)("/admin/raffles");o(e.items)}catch(e){l.ZP.error(e instanceof Error?e.message:"خطا در دریافت قرعه کشی‌ها")}};(0,c.useEffect)(()=>{x()},[]);let m=async()=>{if(!s.title||!s.maxTickets){l.ZP.error("تمام فیلدهای ضروری را تکمیل کنید");return}try{await (0,n.Nv)("/admin/raffles",{method:"POST",body:JSON.stringify({title:s.title,maxTickets:Number(s.maxTickets)})}),l.ZP.success("قرعه کشی جدید ایجاد شد"),t(!1),i({title:"",maxTickets:"1000"}),await x()}catch(e){l.ZP.error(e instanceof Error?e.message:"خطا در ایجاد قرعه کشی")}},h=async(e,t)=>{try{await (0,n.Nv)("/admin/raffles/".concat(e,"/").concat(t),{method:"POST"}),l.ZP.success("وضعیت به‌روزرسانی شد"),await x()}catch(e){l.ZP.error(e instanceof Error?e.message:"خطا در تغییر وضعیت")}},b=async e=>{try{await (0,n.Nv)("/admin/raffles/".concat(e,"/draw"),{method:"POST",body:JSON.stringify({winnersCount:1,externalEntropy:"entropy-".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2))})}),l.ZP.success("Draw با موفقیت انجام شد"),await x()}catch(e){l.ZP.error(e instanceof Error?e.message:"خطا در draw")}};return(0,a.jsxs)("div",{className:"space-y-8",dir:"rtl",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold",children:"مدیریت قرعه کشی"}),(0,a.jsx)("button",{onClick:()=>t(!e),className:"btn-primary",children:"+ ایجاد قرعه کشی جدید"})]}),e&&(0,a.jsxs)(r.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"card glass p-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"تنظیم مبلغ و تعداد قرعه کشی"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-dark-text/60 mb-2",children:"نام قرعه کشی"}),(0,a.jsx)("input",{type:"text",value:s.title,onChange:e=>i({...s,title:e.target.value}),className:"w-full bg-dark-bg/50 rounded-lg px-4 py-3 border border-dark-border text-dark-text"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-dark-text/60 mb-2",children:"تعداد کل بلیط"}),(0,a.jsx)("input",{type:"number",value:s.maxTickets,onChange:e=>i({...s,maxTickets:e.target.value}),className:"w-full bg-dark-bg/50 rounded-lg px-4 py-3 border border-dark-border text-dark-text"})]})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("button",{onClick:m,className:"btn-primary",children:"ثبت قرعه کشی"}),(0,a.jsx)("button",{onClick:()=>t(!1),className:"btn-tertiary",children:"انصراف"})]})]}),(0,a.jsx)("div",{className:"card glass overflow-hidden",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-dark-bg/50 border-b border-dark-border/30",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-4 text-right font-semibold",children:"نام"}),(0,a.jsx)("th",{className:"px-6 py-4 text-right font-semibold",children:"مبلغ پایه"}),(0,a.jsx)("th",{className:"px-6 py-4 text-right font-semibold",children:"فروخته شده"}),(0,a.jsx)("th",{className:"px-6 py-4 text-right font-semibold",children:"وضعیت"}),(0,a.jsx)("th",{className:"px-6 py-4 text-right font-semibold",children:"عملیات"})]})}),(0,a.jsx)("tbody",{children:d.map(e=>{var t,s;return(0,a.jsxs)("tr",{className:"border-b border-dark-border/10 hover:bg-dark-surface/30 transition-colors",children:[(0,a.jsx)("td",{className:"px-6 py-4",children:e.title}),(0,a.jsx)("td",{className:"px-6 py-4",children:(null!==(s=null===(t=e.tiers[0])||void 0===t?void 0:t.price)&&void 0!==s?s:0).toLocaleString("fa-IR")}),(0,a.jsxs)("td",{className:"px-6 py-4",children:[e.ticketsSold.toLocaleString("fa-IR")," / ",e.maxTickets.toLocaleString("fa-IR")]}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("span",{className:"px-3 py-1 rounded-full bg-status-success/10 text-status-success text-sm",children:e.status})}),(0,a.jsxs)("td",{className:"px-6 py-4 flex gap-2",children:["draft"===e.status&&(0,a.jsx)("button",{onClick:()=>h(e.id,"open"),className:"btn-secondary text-sm px-3 py-2",children:"باز"}),"open"===e.status&&(0,a.jsx)("button",{onClick:()=>h(e.id,"close"),className:"btn-secondary text-sm px-3 py-2",children:"بستن"}),"closed"===e.status&&(0,a.jsx)("button",{onClick:()=>b(e.id),className:"btn-secondary text-sm px-3 py-2",children:"Draw"})]})]},e.id)})})]})})]})}}},function(e){e.O(0,[5186,4072,1837,2971,2117,1744],function(){return e(e.s=9447)}),_N_E=e.O()}]);