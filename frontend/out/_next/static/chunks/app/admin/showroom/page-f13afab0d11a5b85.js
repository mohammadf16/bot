(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5861],{2028:function(e,t,r){Promise.resolve().then(r.bind(r,996))},257:function(e,t,r){"use strict";var n,o;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(o=r.g.process)?void 0:o.env)?r.g.process:r(4227)},4227:function(e){!function(){var t={229:function(e){var t,r,n,o=e.exports={};function a(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var l=[],c=!1,d=-1;function u(){c&&n&&(c=!1,n.length?l=n.concat(l):d=-1,l.length&&h())}function h(){if(!c){var e=s(u);c=!0;for(var t=l.length;t;){for(n=l,l=[];++d<t;)n&&n[d].run();d=-1,t=l.length}n=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function p(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new m(e,t)),1!==l.length||c||s(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=p,o.addListener=p,o.once=p,o.off=p,o.removeListener=p,o.removeAllListeners=p,o.emit=p,o.prependListener=p,o.prependOnceListener=p,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var a=r[e]={exports:{}},i=!0;try{t[e](a,a.exports,n),i=!1}finally{i&&delete r[e]}return a.exports}n.ab="//";var o=n(229);e.exports=o}()},996:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var n,o=r(7437),a=r(2265),i=r(5186),s=r(1837);let l=null!==(n=r(257).env.NEXT_PUBLIC_WS_URL)&&void 0!==n?n:"ws://localhost:4000/api/v1/live";function c(){let[e,t]=(0,a.useState)([]),[r,n]=(0,a.useState)([]),[c,d]=(0,a.useState)({title:"",imageUrl:"",sourceType:"external_purchase",listedPriceIrr:"",listedPriceGoldSot:"",acquisitionCostIrr:""});async function u(){try{let[e,r]=await Promise.all([(0,s.Nv)("/admin/showroom/vehicles"),(0,s.Nv)("/admin/showroom/orders")]);t(e.items),n(r.items)}catch(e){i.ZP.error(e instanceof Error?e.message:"خطا در دریافت نمایشگاه")}}(0,a.useEffect)(()=>{u()},[]),(0,a.useEffect)(()=>{let e=(0,s.hP)(),t=new WebSocket(e?"".concat(l,"?token=").concat(encodeURIComponent(e)):l);return t.onmessage=e=>{try{var t;let r=JSON.parse(e.data);if("event"!==r.type)return;let n=null===(t=r.payload)||void 0===t?void 0:t.type;("showroom.vehicle"===n||"showroom.order"===n)&&u()}catch(e){}},()=>t.close()},[]);let h=(0,a.useMemo)(()=>({available:e.filter(e=>"available"===e.status).length,sold:e.filter(e=>"sold"===e.status).length,ordersPaid:r.filter(e=>"paid"===e.status).length}),[e,r]);async function m(){if(!c.title.trim()||!c.imageUrl.trim())return i.ZP.error("عنوان و عکس لازم است");try{await (0,s.Nv)("/admin/showroom/vehicles",{method:"POST",body:JSON.stringify({title:c.title.trim(),imageUrl:c.imageUrl.trim(),sourceType:c.sourceType,listedPriceIrr:c.listedPriceIrr?Number(c.listedPriceIrr):void 0,listedPriceGoldSot:c.listedPriceGoldSot?Number(c.listedPriceGoldSot):void 0,acquisitionCostIrr:c.acquisitionCostIrr?Number(c.acquisitionCostIrr):void 0})}),d({title:"",imageUrl:"",sourceType:"external_purchase",listedPriceIrr:"",listedPriceGoldSot:"",acquisitionCostIrr:""}),i.ZP.success("خودرو به نمایشگاه اضافه شد"),await u()}catch(e){i.ZP.error(e instanceof Error?e.message:"ثبت خودرو ناموفق بود")}}async function p(e,t){try{await (0,s.Nv)("/admin/showroom/vehicles/".concat(e),{method:"PUT",body:JSON.stringify({status:t})}),await u()}catch(e){i.ZP.error(e instanceof Error?e.message:"تغییر وضعیت خودرو ناموفق بود")}}async function f(e,t){try{await (0,s.Nv)("/admin/showroom/orders/".concat(e,"/status"),{method:"POST",body:JSON.stringify({status:t})}),await u()}catch(e){i.ZP.error(e instanceof Error?e.message:"تغییر وضعیت سفارش ناموفق بود")}}return(0,o.jsxs)("div",{className:"space-y-6",dir:"rtl",children:[(0,o.jsx)("h1",{className:"text-3xl font-black",children:"مدیریت نمایشگاه و حواله خودرو"}),(0,o.jsxs)("section",{className:"grid md:grid-cols-3 gap-3",children:[(0,o.jsxs)("div",{className:"card glass p-4",children:["خودرو قابل خرید: ",h.available.toLocaleString("fa-IR")]}),(0,o.jsxs)("div",{className:"card glass p-4",children:["خودرو فروخته شده: ",h.sold.toLocaleString("fa-IR")]}),(0,o.jsxs)("div",{className:"card glass p-4",children:["سفارش پرداخت شده: ",h.ordersPaid.toLocaleString("fa-IR")]})]}),(0,o.jsxs)("section",{className:"card glass p-6 space-y-3",children:[(0,o.jsx)("h2",{className:"text-xl font-black",children:"افزودن خودرو"}),(0,o.jsxs)("div",{className:"grid md:grid-cols-3 gap-3",children:[(0,o.jsx)("input",{value:c.title,onChange:e=>d(t=>({...t,title:e.target.value})),className:"bg-black/30 border border-white/15 rounded-xl px-3 py-2",placeholder:"عنوان خودرو"}),(0,o.jsx)("input",{value:c.imageUrl,onChange:e=>d(t=>({...t,imageUrl:e.target.value})),className:"bg-black/30 border border-white/15 rounded-xl px-3 py-2",placeholder:"آدرس عکس"}),(0,o.jsxs)("select",{value:c.sourceType,onChange:e=>d(t=>({...t,sourceType:e.target.value})),className:"bg-black/30 border border-white/15 rounded-xl px-3 py-2",children:[(0,o.jsx)("option",{value:"external_purchase",children:"خرید مستقیم سایت"}),(0,o.jsx)("option",{value:"lottery_winback",children:"بازخرید از برنده"})]}),(0,o.jsx)("input",{value:c.listedPriceIrr,onChange:e=>d(t=>({...t,listedPriceIrr:e.target.value})),className:"bg-black/30 border border-white/15 rounded-xl px-3 py-2",placeholder:"قیمت تومان"}),(0,o.jsx)("input",{value:c.listedPriceGoldSot,onChange:e=>d(t=>({...t,listedPriceGoldSot:e.target.value})),className:"bg-black/30 border border-white/15 rounded-xl px-3 py-2",placeholder:"قیمت سوت"}),(0,o.jsx)("input",{value:c.acquisitionCostIrr,onChange:e=>d(t=>({...t,acquisitionCostIrr:e.target.value})),className:"bg-black/30 border border-white/15 rounded-xl px-3 py-2",placeholder:"هزینه تملک"})]}),(0,o.jsx)("button",{onClick:m,className:"btn-primary",children:"ثبت خودرو"})]}),(0,o.jsxs)("section",{className:"card glass p-6",children:[(0,o.jsx)("h2",{className:"text-xl font-black mb-3",children:"خودروها"}),(0,o.jsxs)("div",{className:"space-y-2",children:[e.map(e=>{var t,r,n,a;return(0,o.jsxs)("div",{className:"p-3 rounded-xl border border-white/10 bg-black/20 flex flex-wrap items-center justify-between gap-3",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"font-bold",children:String(null!==(r=null===(t=e.vehicle)||void 0===t?void 0:t.title)&&void 0!==r?r:e.id)}),(0,o.jsxs)("p",{className:"text-xs text-white/60",children:[e.status," | IRR: ",null!==(n=e.listedPriceIrr)&&void 0!==n?n:"-"," | SOT: ",null!==(a=e.listedPriceGoldSot)&&void 0!==a?a:"-"]})]}),(0,o.jsx)("div",{className:"flex gap-2",children:["available","reserved","sold","archived"].map(t=>(0,o.jsx)("button",{onClick:()=>void p(e.id,t),className:"px-3 py-1 rounded-lg text-xs border ".concat(e.status===t?"border-accent-gold text-accent-gold":"border-white/20 text-white/70"),children:t},t))})]},e.id)}),e.length?null:(0,o.jsx)("p",{className:"text-sm text-white/50",children:"خودرویی ثبت نشده است."})]})]}),(0,o.jsxs)("section",{className:"card glass p-6",children:[(0,o.jsx)("h2",{className:"text-xl font-black mb-3",children:"سفارش‌ها"}),(0,o.jsxs)("div",{className:"space-y-2",children:[r.map(e=>(0,o.jsxs)("div",{className:"p-3 rounded-xl border border-white/10 bg-black/20 flex flex-wrap items-center justify-between gap-3",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"font-bold",children:e.vehicleTitle}),(0,o.jsxs)("p",{className:"text-xs text-white/60",children:[e.buyerEmail," | ",e.paymentAsset," | ",e.paymentAmount.toLocaleString("fa-IR")," | ",e.status]})]}),(0,o.jsx)("div",{className:"flex gap-2",children:["pending","paid","completed","cancelled"].map(t=>(0,o.jsx)("button",{onClick:()=>void f(e.id,t),className:"px-3 py-1 rounded-lg text-xs border ".concat(e.status===t?"border-accent-gold text-accent-gold":"border-white/20 text-white/70"),children:t},t))})]},e.id)),r.length?null:(0,o.jsx)("p",{className:"text-sm text-white/50",children:"سفارشی وجود ندارد."})]})]})]})}},1837:function(e,t,r){"use strict";r.d(t,{Je:function(){return u},Nv:function(){return p},c8:function(){return f},hP:function(){return c},vD:function(){return d}});var n,o=r(257);let a=null!==(n=o.env.NEXT_PUBLIC_API_URL)&&void 0!==n?n:"http://localhost:4000/api/v1",i=o.env.NEXT_PUBLIC_API_GATEWAY_KEY,s="car_access_token",l="car_refresh_token";function c(){return localStorage.getItem(s)}function d(e){localStorage.setItem(s,e.accessToken),localStorage.setItem(l,e.refreshToken)}function u(){localStorage.removeItem(s),localStorage.removeItem(l)}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=new Headers(t.headers);void 0!==t.body&&null!==t.body&&n.set("Content-Type","application/json"),i&&n.set("x-api-gateway-key",i),r&&n.set("Authorization","Bearer ".concat(r));let o=await fetch("".concat(a).concat(e),{...t,headers:n});if(!o.ok){var s,l;let e=await o.json().catch(()=>({}));throw Error(null!==(l=null!==(s=e.error)&&void 0!==s?s:e.message)&&void 0!==l?l:"HTTP_".concat(o.status))}return 204===o.status?{}:await o.json()}async function m(){let e=localStorage.getItem(l);if(!e)return null;try{let t=await h("/auth/refresh",{method:"POST",body:JSON.stringify({refreshToken:e})});return d(t),t.accessToken}catch(e){return u(),null}}async function p(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{auth:!0},o=null===(t=n.auth)||void 0===t||t,a=o?c():void 0;try{return await h(e,r,null!=a?a:void 0)}catch(n){if(!o)throw n;let t=await m();if(!t)throw n;return h(e,r,t)}}function f(){return"undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():"idemp-".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2))}}},function(e){e.O(0,[5186,2971,2117,1744],function(){return e(e.s=2028)}),_N_E=e.O()}]);