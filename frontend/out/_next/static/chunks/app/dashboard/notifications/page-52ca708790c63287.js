(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1258],{9152:function(t,e,n){Promise.resolve().then(n.bind(n,8575))},257:function(t,e,n){"use strict";var r,o;t.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(o=n.g.process)?void 0:o.env)?n.g.process:n(4227)},4227:function(t){!function(){var e={229:function(t){var e,n,r,o=t.exports={};function i(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function c(t){if(e===setTimeout)return setTimeout(t,0);if((e===i||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(n){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:i}catch(t){e=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var s=[],l=!1,u=-1;function f(){l&&r&&(l=!1,r.length?s=r.concat(s):u=-1,s.length&&d())}function d(){if(!l){var t=c(f);l=!0;for(var e=s.length;e;){for(r=s,s=[];++u<e;)r&&r[u].run();u=-1,e=s.length}r=null,l=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function h(t,e){this.fun=t,this.array=e}function m(){}o.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new h(t,e)),1!==s.length||l||c(d)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(t){return[]},o.binding=function(t){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},n={};function r(t){var o=n[t];if(void 0!==o)return o.exports;var i=n[t]={exports:{}},a=!0;try{e[t](i,i.exports,r),a=!1}finally{a&&delete n[t]}return i.exports}r.ab="//";var o=r(229);t.exports=o}()},8575:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return c}});var r=n(7437),o=n(2265),i=n(5186),a=n(1837);function c(){let[t,e]=(0,o.useState)([]),[n,c]=(0,o.useState)(!0);async function s(){try{let t=await (0,a.Nv)("/me/notifications",{method:"GET"});e(t.items)}catch(t){i.ZP.error(t instanceof Error?t.message:"خطا در دریافت اعلان ها")}finally{c(!1)}}async function l(t){try{await (0,a.Nv)("/me/notifications/".concat(t,"/read"),{method:"POST"}),e(e=>e.map(e=>{var n;return e.id===t?{...e,readAt:null!==(n=e.readAt)&&void 0!==n?n:new Date().toISOString()}:e}))}catch(t){i.ZP.error(t instanceof Error?t.message:"خطا در بروزرسانی اعلان")}}async function u(){try{await (0,a.Nv)("/me/notifications/read-all",{method:"POST"});let t=new Date().toISOString();e(e=>e.map(e=>{var n;return{...e,readAt:null!==(n=e.readAt)&&void 0!==n?n:t}}))}catch(t){i.ZP.error(t instanceof Error?t.message:"خطا در خواندن همه اعلان ها")}}return(0,o.useEffect)(()=>{s()},[]),(0,r.jsxs)("div",{className:"space-y-6",dir:"rtl",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,r.jsx)("h1",{className:"text-2xl font-black",children:"اعلان ها"}),(0,r.jsx)("button",{onClick:()=>void u(),className:"btn-secondary text-xs px-4 py-2",children:"خواندن همه"})]}),n?(0,r.jsx)("p",{className:"text-white/50 text-sm",children:"در حال بارگذاری..."}):(0,r.jsxs)("div",{className:"space-y-3",children:[t.map(t=>(0,r.jsxs)("button",{onClick:()=>{t.readAt||l(t.id)},className:"w-full text-right p-4 rounded-2xl border transition ".concat(t.readAt?"bg-white/5 border-white/10":"bg-[#D4AF37]/10 border-[#D4AF37]/30"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,r.jsx)("p",{className:"font-bold",children:t.title}),(0,r.jsx)("span",{className:"text-[10px] text-white/40",children:new Date(t.createdAt).toLocaleString("fa-IR")})]}),t.body?(0,r.jsx)("p",{className:"text-xs text-white/65 mt-2",children:t.body}):null]},t.id)),t.length?null:(0,r.jsx)("p",{className:"text-sm text-white/50",children:"اعلانی ندارید."})]})]})}},1837:function(t,e,n){"use strict";n.d(e,{Je:function(){return f},Nv:function(){return m},c8:function(){return p},hP:function(){return l},vD:function(){return u}});var r,o=n(257);let i=null!==(r=o.env.NEXT_PUBLIC_API_URL)&&void 0!==r?r:"http://localhost:4000/api/v1",a=o.env.NEXT_PUBLIC_API_GATEWAY_KEY,c="car_access_token",s="car_refresh_token";function l(){return localStorage.getItem(c)}function u(t){localStorage.setItem(c,t.accessToken),localStorage.setItem(s,t.refreshToken)}function f(){localStorage.removeItem(c),localStorage.removeItem(s)}async function d(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=new Headers(e.headers);void 0!==e.body&&null!==e.body&&r.set("Content-Type","application/json"),a&&r.set("x-api-gateway-key",a),n&&r.set("Authorization","Bearer ".concat(n));let o=await fetch("".concat(i).concat(t),{...e,headers:r});if(!o.ok){var c,s;let t=await o.json().catch(()=>({}));throw Error(null!==(s=null!==(c=t.error)&&void 0!==c?c:t.message)&&void 0!==s?s:"HTTP_".concat(o.status))}return 204===o.status?{}:await o.json()}async function h(){let t=localStorage.getItem(s);if(!t)return null;try{let e=await d("/auth/refresh",{method:"POST",body:JSON.stringify({refreshToken:t})});return u(e),e.accessToken}catch(t){return f(),null}}async function m(t){var e;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{auth:!0},o=null===(e=r.auth)||void 0===e||e,i=o?l():void 0;try{return await d(t,n,null!=i?i:void 0)}catch(r){if(!o)throw r;let e=await h();if(!e)throw r;return d(t,n,e)}}function p(){return"undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():"idemp-".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2))}}},function(t){t.O(0,[5186,2971,2117,1744],function(){return t(t.s=9152)}),_N_E=t.O()}]);