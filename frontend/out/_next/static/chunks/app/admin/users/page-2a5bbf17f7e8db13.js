(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9674],{8554:function(e,l,r){Promise.resolve().then(r.bind(r,3058))},3058:function(e,l,r){"use strict";r.r(l),r.d(l,{default:function(){return d}});var s=r(7437),a=r(2265),t=r(5186),n=r(1837),i=r(7921);function d(){let[e,l]=(0,a.useState)([]),[r,d]=(0,a.useState)(!0),[c,u]=(0,a.useState)(null),[h,x]=(0,a.useState)(!1),[b,m]=(0,a.useState)(null);async function p(){d(!0);try{let e=await (0,n.Nv)("/admin/users");l(e.items)}catch(e){t.ZP.error(e instanceof Error?e.message:"خطا در دریافت کاربران")}finally{d(!1)}}(0,a.useEffect)(()=>{p()},[]);let f=(0,a.useMemo)(()=>{var l;return null!==(l=e.find(e=>e.id===c))&&void 0!==l?l:null},[e,c]);async function v(e){try{var l,r,s,a,i,d,o,c,h,x,b,p;let t=await (0,n.Nv)("/admin/users/".concat(e));u(e),m({role:t.user.role,status:t.user.status,walletBalance:t.user.walletBalance,chances:t.user.chances,fullName:null!==(o=null===(l=t.user.profile)||void 0===l?void 0:l.fullName)&&void 0!==o?o:"",username:null!==(c=null===(r=t.user.profile)||void 0===r?void 0:r.username)&&void 0!==c?c:"",phone:null!==(h=null===(s=t.user.profile)||void 0===s?void 0:s.phone)&&void 0!==h?h:"",city:null!==(x=null===(a=t.user.profile)||void 0===a?void 0:a.city)&&void 0!==x?x:"",address:null!==(b=null===(i=t.user.profile)||void 0===i?void 0:i.address)&&void 0!==b?b:"",bio:null!==(p=null===(d=t.user.profile)||void 0===d?void 0:d.bio)&&void 0!==p?p:""})}catch(e){t.ZP.error(e instanceof Error?e.message:"خطا در دریافت اطلاعات کاربر")}}async function g(){if(c&&b){x(!0);try{await (0,n.Nv)("/admin/users/".concat(c),{method:"PUT",body:JSON.stringify({role:b.role,status:b.status,walletBalance:Number(b.walletBalance),chances:Number(b.chances),profile:{fullName:b.fullName||void 0,username:b.username||void 0,phone:b.phone||void 0,city:b.city||void 0,address:b.address||void 0,bio:b.bio||void 0}})}),t.ZP.success("اطلاعات کاربر ذخیره شد"),await p(),u(null),m(null)}catch(e){t.ZP.error(e instanceof Error?e.message:"خطا در ذخیره اطلاعات کاربر")}finally{x(!1)}}}return(0,s.jsxs)("div",{className:"space-y-6",dir:"rtl",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold",children:"مدیریت کاربران"}),(0,s.jsx)("div",{className:"card glass overflow-hidden",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-dark-bg/50 border-b border-dark-border/30",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-4 text-right font-semibold",children:"ایمیل"}),(0,s.jsx)("th",{className:"px-6 py-4 text-right font-semibold",children:"نام"}),(0,s.jsx)("th",{className:"px-6 py-4 text-right font-semibold",children:"نقش"}),(0,s.jsx)("th",{className:"px-6 py-4 text-right font-semibold",children:"موجودی"}),(0,s.jsx)("th",{className:"px-6 py-4 text-right font-semibold",children:"شانس"}),(0,s.jsx)("th",{className:"px-6 py-4 text-right font-semibold",children:"وضعیت"}),(0,s.jsx)("th",{className:"px-6 py-4 text-right font-semibold",children:"عملیات"})]})}),(0,s.jsxs)("tbody",{children:[r&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{className:"px-6 py-6",colSpan:7,children:"در حال بارگذاری..."})}),!r&&e.map(e=>{var l;return(0,s.jsxs)("tr",{className:"border-b border-dark-border/10",children:[(0,s.jsx)("td",{className:"px-6 py-4",children:e.email}),(0,s.jsx)("td",{className:"px-6 py-4",children:(null===(l=e.profile)||void 0===l?void 0:l.fullName)||"-"}),(0,s.jsx)("td",{className:"px-6 py-4",children:"admin"===e.role?"ادمین":"کاربر"}),(0,s.jsxs)("td",{className:"px-6 py-4",children:[(0,i.d)(e.walletBalance)," تومان"]}),(0,s.jsx)("td",{className:"px-6 py-4",children:e.chances.toLocaleString("fa-IR")}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsx)("span",{className:"px-3 py-1 rounded-full text-xs ".concat("active"===e.status?"bg-emerald-500/10 text-emerald-400":"bg-rose-500/10 text-rose-400"),children:"active"===e.status?"فعال":"مسدود"})}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsx)("button",{onClick:()=>v(e.id),className:"px-3 py-2 rounded-lg border border-white/20 hover:bg-white/10",children:"ویرایش"})})]},e.id)})]})]})}),f&&b&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"w-full max-w-3xl bg-[#0A0A0A] border border-white/10 rounded-2xl p-6 max-h-[92vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-black",children:"ویرایش کاربر"}),(0,s.jsx)("button",{onClick:()=>{u(null),m(null)},className:"text-white/60 hover:text-white",children:"بستن"})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,s.jsx)(o,{label:"ایمیل",children:(0,s.jsx)("input",{value:f.email,disabled:!0,className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2 opacity-70"})}),(0,s.jsx)(o,{label:"نقش",children:(0,s.jsxs)("select",{value:b.role,onChange:e=>m(l=>l?{...l,role:e.target.value}:l),className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2",children:[(0,s.jsx)("option",{value:"user",children:"کاربر"}),(0,s.jsx)("option",{value:"admin",children:"ادمین"})]})}),(0,s.jsx)(o,{label:"وضعیت",children:(0,s.jsxs)("select",{value:b.status,onChange:e=>m(l=>l?{...l,status:e.target.value}:l),className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2",children:[(0,s.jsx)("option",{value:"active",children:"فعال"}),(0,s.jsx)("option",{value:"suspended",children:"مسدود"})]})}),(0,s.jsx)(o,{label:"موجودی (تومان)",children:(0,s.jsx)("input",{type:"number",value:b.walletBalance,onChange:e=>m(l=>l?{...l,walletBalance:Number(e.target.value)}:l),className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2"})}),(0,s.jsx)(o,{label:"شانس",children:(0,s.jsx)("input",{type:"number",value:b.chances,onChange:e=>m(l=>l?{...l,chances:Number(e.target.value)}:l),className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2"})}),(0,s.jsx)(o,{label:"نام کامل",children:(0,s.jsx)("input",{value:b.fullName,onChange:e=>m(l=>l?{...l,fullName:e.target.value}:l),className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2"})}),(0,s.jsx)(o,{label:"نام کاربری",children:(0,s.jsx)("input",{value:b.username,onChange:e=>m(l=>l?{...l,username:e.target.value}:l),className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2"})}),(0,s.jsx)(o,{label:"موبایل",children:(0,s.jsx)("input",{value:b.phone,onChange:e=>m(l=>l?{...l,phone:e.target.value}:l),className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2"})}),(0,s.jsx)(o,{label:"شهر",children:(0,s.jsx)("input",{value:b.city,onChange:e=>m(l=>l?{...l,city:e.target.value}:l),className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2"})}),(0,s.jsx)(o,{label:"آدرس",children:(0,s.jsx)("input",{value:b.address,onChange:e=>m(l=>l?{...l,address:e.target.value}:l),className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2"})})]}),(0,s.jsx)(o,{label:"بیو",children:(0,s.jsx)("textarea",{value:b.bio,onChange:e=>m(l=>l?{...l,bio:e.target.value}:l),className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2 min-h-24"})}),(0,s.jsx)("button",{onClick:g,disabled:h,className:"btn-primary mt-6 disabled:opacity-60",children:h?"در حال ذخیره...":"ذخیره تغییرات"})]})})]})}function o(e){let{label:l,children:r}=e;return(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-xs text-white/60 mb-1",children:l}),r]})}},7921:function(e,l,r){"use strict";function s(e){return(Number.isFinite(e)?Math.trunc(e):0).toLocaleString("fa-IR")}function a(e){if(!e.trim())return null;let l=e.split("").map(e=>{let l="۰۱۲۳۴۵۶۷۸۹".indexOf(e);if(l>=0)return String(l);let r="٠١٢٣٤٥٦٧٨٩".indexOf(e);return r>=0?String(r):e}).join("").toLowerCase().replace(/,/g,"").trim(),r=l.includes("million")||l.includes("میلیون")||/\d+(\.\d+)?\s*m\b/.test(l),s=Number(l.replace(/[^\d.]/g,""));if(!Number.isFinite(s)||s<=0)return null;let a=Math.trunc(r?1e6*s:s);return a<=0?null:a}r.d(l,{C:function(){return a},d:function(){return s}})}},function(e){e.O(0,[5186,1837,2971,2117,1744],function(){return e(e.s=8554)}),_N_E=e.O()}]);