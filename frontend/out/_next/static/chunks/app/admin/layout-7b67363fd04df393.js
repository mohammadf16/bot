(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9091],{3636:function(e,t,a){Promise.resolve().then(a.bind(a,6631))},6631:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return A}});var n=a(7437),l=a(2265),r=a(7648),s=a(9376),i=a(5466),c=a(5805),o=a(8226),d=a(9474),h=a(370),u=a(7414),x=a(5287),m=a(8736),f=a(3578),b=a(1169),p=a(7662),w=a(3417),g=a(7656),v=a(7692),N=a(2489),j=a(8293),y=a(3247),k=a(4766),S=a(7766),C=a(5186),_=a(1837);function A(e){var t;let{children:a}=e,[A,T]=(0,l.useState)(!1),[Z,P]=(0,l.useState)(!1),[I,E]=(0,l.useState)([]),[O,D]=(0,l.useState)(0),U=(0,s.usePathname)(),J=(0,s.useRouter)(),{user:z,isLoading:L,logout:M}=(0,S.a)();(0,l.useEffect)(()=>{if(!L){if(!z){J.replace("/login");return}"admin"!==z.role&&J.replace("/dashboard")}},[L,z,J]),(0,l.useEffect)(()=>{z&&"admin"===z.role&&(async()=>{try{let e=await (0,_.Nv)("/me/notifications",{method:"GET"});E(e.items),D(e.unreadCount)}catch(e){}})()},[z]);let B=(0,l.useMemo)(()=>I.slice(0,8),[I]);async function F(e){try{await (0,_.Nv)("/me/notifications/".concat(e,"/read"),{method:"POST"}),E(t=>t.map(t=>{var a;return t.id===e?{...t,readAt:null!==(a=t.readAt)&&void 0!==a?a:new Date().toISOString()}:t})),D(e=>Math.max(0,e-1))}catch(e){}}async function G(){try{await (0,_.Nv)("/me/notifications/read-all",{method:"POST"});let e=new Date().toISOString();E(t=>t.map(t=>{var a;return{...t,readAt:null!==(a=t.readAt)&&void 0!==a?a:e}})),D(0)}catch(e){}}let H=[{label:"داشبورد",href:"/admin/dashboard",icon:i.Z},{label:"کاربران",href:"/admin/users",icon:c.Z},{label:"مدیریت مالی و کیف پول",href:"/admin/finance",icon:o.Z},{label:"مدیریت قرعه کشی",href:"/admin/raffles",icon:d.Z},{label:"تعرفه و قیمت گذاری",href:"/admin/pricing",icon:h.Z},{label:"بازی ها و شانس",href:"/admin/wheel",icon:u.Z},{label:"مانیتورینگ لایو",href:"/admin/live",icon:x.Z},{label:"قوانین و محتوا",href:"/admin/content",icon:m.Z},{label:"گزارش امنیت",href:"/admin/audit",icon:f.Z},{label:"مدیریت مزایده",href:"/admin/rewards",icon:b.Z},{label:"مدیریت نمایشگاه",href:"/admin/showroom",icon:p.Z},{label:"تیکت پشتیبانی",href:"/admin/support",icon:w.Z},{label:"قرعه کشی اسلاید",href:"/admin/slide",icon:g.Z}];return(0,n.jsxs)("div",{className:"min-h-screen bg-[#080808] text-white flex",dir:"rtl",children:[(0,n.jsx)("aside",{className:"\n        fixed lg:sticky top-0 h-screen z-50 bg-[#0C0C0C] border-l border-white/5 transition-all duration-300 overflow-hidden\n        ".concat(A?"w-72 right-0":"w-72 -right-72 lg:right-0","\n      "),children:(0,n.jsxs)("div",{className:"h-full flex flex-col p-6 min-h-0",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4 mb-12 px-2",children:[(0,n.jsx)("div",{className:"w-10 h-10 bg-accent-gold rounded-xl flex items-center justify-center",children:(0,n.jsx)(f.Z,{className:"w-6 h-6 text-black"})}),(0,n.jsxs)("h1",{className:"text-xl font-black tracking-tighter",children:["پنل ",(0,n.jsx)("span",{className:"text-accent-gold",children:"مدیریت"})]})]}),(0,n.jsx)("nav",{className:"flex-1 min-h-0 space-y-2 overflow-y-auto pr-1",children:H.map(e=>{let t=e.icon,a=U===e.href;return(0,n.jsxs)(r.default,{href:e.href,onClick:()=>T(!1),className:"\n                    flex items-center gap-4 px-4 py-3.5 rounded-2xl transition-all group\n                    ".concat(a?"bg-accent-gold text-black font-bold shadow-[0_0_20px_rgba(255,215,0,0.2)]":"hover:bg-white/5 text-white/50 hover:text-white","\n                  "),children:[(0,n.jsx)(t,{className:"w-5 h-5 ".concat(a?"text-black":"group-hover:scale-110 transition-transform")}),(0,n.jsx)("span",{className:"text-sm",children:e.label})]},e.href)})}),(0,n.jsx)("div",{className:"mt-auto pt-6 border-t border-white/5",children:(0,n.jsxs)("button",{className:"flex items-center gap-4 px-4 py-3.5 rounded-2xl text-red-500 hover:bg-red-500/10 transition-colors w-full",onClick:async()=>{await M(),C.ZP.success("از پنل خارج شدید"),J.push("/login")},children:[(0,n.jsx)(v.Z,{className:"w-5 h-5"}),(0,n.jsx)("span",{className:"text-sm font-bold",children:"خروج از پنل"})]})})]})}),(0,n.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,n.jsxs)("header",{className:"h-20 border-b border-white/5 bg-[#080808]/80 backdrop-blur-xl sticky top-0 z-40 px-4 md:px-8 flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)("button",{onClick:()=>T(!A),className:"lg:hidden p-2 hover:bg-white/5 rounded-xl transition-colors",children:A?(0,n.jsx)(N.Z,{}):(0,n.jsx)(j.Z,{})}),(0,n.jsxs)("div",{className:"hidden md:flex items-center gap-3 bg-white/5 px-4 py-2 rounded-xl border border-white/5 w-64 lg:w-96",children:[(0,n.jsx)(y.Z,{className:"w-4 h-4 text-white/30"}),(0,n.jsx)("input",{type:"text",placeholder:"جستجو در پنل مدیریت...",className:"bg-transparent border-none outline-none text-sm w-full placeholder:text-white/20"})]})]}),(0,n.jsxs)("div",{className:"relative flex items-center gap-3 md:gap-6",children:[(0,n.jsxs)("button",{onClick:()=>P(e=>!e),className:"relative p-2 hover:bg-white/5 rounded-xl transition-colors group",children:[(0,n.jsx)(k.Z,{className:"w-5 h-5 text-white/50 group-hover:text-white"}),O>0?(0,n.jsx)("span",{className:"absolute -top-1 -right-1 min-w-5 h-5 px-1 bg-[#D4AF37] text-black text-[10px] font-black rounded-full border border-[#080808] flex items-center justify-center",children:O>99?"99+":O}):null]}),Z&&(0,n.jsxs)("div",{className:"absolute left-0 top-12 w-[360px] max-w-[92vw] bg-[#0A0A0A] border border-white/10 rounded-2xl p-4 shadow-2xl z-50",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsx)("p",{className:"font-black text-sm",children:"اعلان‌ها"}),(0,n.jsx)("button",{onClick:G,className:"text-xs text-accent-gold hover:underline",children:"خواندن همه"})]}),(0,n.jsxs)("div",{className:"max-h-80 overflow-y-auto space-y-2",children:[B.map(e=>(0,n.jsxs)("button",{onClick:()=>{e.readAt||F(e.id)},className:"w-full text-right p-3 rounded-xl border transition ".concat(e.readAt?"bg-white/5 border-white/10":"bg-[#D4AF37]/10 border-[#D4AF37]/30"),children:[(0,n.jsx)("p",{className:"text-sm font-bold",children:e.title}),e.body?(0,n.jsx)("p",{className:"text-xs text-white/60 mt-1",children:e.body}):null,(0,n.jsx)("p",{className:"text-[10px] text-white/40 mt-1",children:new Date(e.createdAt).toLocaleString("fa-IR")})]},e.id)),B.length?null:(0,n.jsx)("p",{className:"text-xs text-white/50 p-2",children:"اعلانی ندارید."})]})]}),(0,n.jsx)("div",{className:"h-8 w-px bg-white/10"}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsxs)("div",{className:"text-right hidden sm:block",children:[(0,n.jsx)("p",{className:"text-sm font-bold",children:"مدیر سیستم"}),(0,n.jsx)("p",{className:"text-[10px] text-white/30 uppercase tracking-widest",children:null!==(t=null==z?void 0:z.email)&&void 0!==t?t:"Admin"})]}),(0,n.jsx)("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-accent-gold to-yellow-600 p-px",children:(0,n.jsx)("div",{className:"w-full h-full rounded-[11px] bg-[#0C0C0C] flex items-center justify-center",children:(0,n.jsx)(c.Z,{className:"w-5 h-5 text-accent-gold"})})})]})]})]}),(0,n.jsx)("main",{className:"p-4 md:p-8 max-w-7xl mx-auto w-full",children:a})]}),A&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 lg:hidden",onClick:()=>T(!1)})]})}},1837:function(e,t,a){"use strict";a.d(t,{Je:function(){return h},Nv:function(){return m},c8:function(){return f},hP:function(){return o},vD:function(){return d}});var n,l=a(257);let r=null!==(n=l.env.NEXT_PUBLIC_API_URL)&&void 0!==n?n:"http://localhost:4000/api/v1",s=l.env.NEXT_PUBLIC_API_GATEWAY_KEY,i="car_access_token",c="car_refresh_token";function o(){return localStorage.getItem(i)}function d(e){localStorage.setItem(i,e.accessToken),localStorage.setItem(c,e.refreshToken)}function h(){localStorage.removeItem(i),localStorage.removeItem(c)}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0,n=new Headers(t.headers);void 0!==t.body&&null!==t.body&&n.set("Content-Type","application/json"),s&&n.set("x-api-gateway-key",s),a&&n.set("Authorization","Bearer ".concat(a));let l=await fetch("".concat(r).concat(e),{...t,headers:n});if(!l.ok){var i,c;let e=await l.json().catch(()=>({}));throw Error(null!==(c=null!==(i=e.error)&&void 0!==i?i:e.message)&&void 0!==c?c:"HTTP_".concat(l.status))}return 204===l.status?{}:await l.json()}async function x(){let e=localStorage.getItem(c);if(!e)return null;try{let t=await u("/auth/refresh",{method:"POST",body:JSON.stringify({refreshToken:e})});return d(t),t.accessToken}catch(e){return h(),null}}async function m(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{auth:!0},l=null===(t=n.auth)||void 0===t||t,r=l?o():void 0;try{return await u(e,a,null!=r?r:void 0)}catch(n){if(!l)throw n;let t=await x();if(!t)throw n;return u(e,a,t)}}function f(){return"undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():"idemp-".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2))}},7766:function(e,t,a){"use strict";a.d(t,{H:function(){return c},a:function(){return o}});var n=a(7437),l=a(2265),r=a(1837);let s=(0,l.createContext)(null);async function i(){return(0,r.Nv)("/me",{method:"GET"},{auth:!0})}function c(e){let{children:t}=e,[a,c]=(0,l.useState)(null),[o,d]=(0,l.useState)(!0),h=(0,l.useCallback)(async()=>{c(await i())},[]);(0,l.useEffect)(()=>{let e=!0;return(async()=>{try{let t=await i();e&&c(t)}catch(t){e&&c(null)}finally{e&&d(!1)}})(),()=>{e=!1}},[]);let u=(0,l.useCallback)(async e=>{let{email:t,password:a}=e,n=await (0,r.Nv)("/auth/login",{method:"POST",body:JSON.stringify({email:t,password:a})},{auth:!1});return(0,r.vD)({accessToken:n.accessToken,refreshToken:n.refreshToken}),c(n.user),n.user},[]),x=(0,l.useCallback)(async e=>{let{email:t,password:a,referralCode:n}=e;await (0,r.Nv)("/auth/register",{method:"POST",body:JSON.stringify({email:t,password:a,referralCode:n})},{auth:!1})},[]),m=(0,l.useCallback)(async()=>{try{let e=localStorage.getItem("car_refresh_token");e&&await (0,r.Nv)("/auth/logout",{method:"POST",body:JSON.stringify({refreshToken:e})})}catch(e){}finally{(0,r.Je)(),c(null)}},[]),f=(0,l.useMemo)(()=>({user:a,isLoading:o,isAuthenticated:!!a,login:u,register:x,logout:m,refreshMe:h}),[a,o,u,x,m,h]);return(0,n.jsx)(s.Provider,{value:f,children:t})}function o(){let e=(0,l.useContext)(s);if(!e)throw Error("useAuth must be used within AuthProvider");return e}}},function(e){e.O(0,[5186,2972,3472,2971,2117,1744],function(){return e(e.s=3636)}),_N_E=e.O()}]);