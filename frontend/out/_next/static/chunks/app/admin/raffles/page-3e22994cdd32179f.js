(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[135],{6881:function(t,e,r){Promise.resolve().then(r.bind(r,1546))},257:function(t,e,r){"use strict";var n,a;t.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(a=r.g.process)?void 0:a.env)?r.g.process:r(4227)},4227:function(t){!function(){var e={229:function(t){var e,r,n,a=t.exports={};function s(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function c(t){if(e===setTimeout)return setTimeout(t,0);if((e===s||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(r){try{return e.call(null,t,0)}catch(r){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:s}catch(t){e=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(t){r=o}}();var i=[],l=!1,u=-1;function d(){l&&n&&(l=!1,n.length?i=n.concat(i):u=-1,i.length&&h())}function h(){if(!l){var t=c(d);l=!0;for(var e=i.length;e;){for(n=i,i=[];++u<e;)n&&n[u].run();u=-1,e=i.length}n=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function m(){}a.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];i.push(new f(t,e)),1!==i.length||l||c(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=m,a.addListener=m,a.once=m,a.off=m,a.removeListener=m,a.removeAllListeners=m,a.emit=m,a.prependListener=m,a.prependOnceListener=m,a.listeners=function(t){return[]},a.binding=function(t){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},r={};function n(t){var a=r[t];if(void 0!==a)return a.exports;var s=r[t]={exports:{}},o=!0;try{e[t](s,s.exports,n),o=!1}finally{o&&delete r[t]}return s.exports}n.ab="//";var a=n(229);t.exports=a}()},1546:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return i}});var n=r(7437),a=r(4072),s=r(2265),o=r(5186),c=r(1837);function i(){let[t,e]=(0,s.useState)(!1),[r,i]=(0,s.useState)({title:"",maxTickets:"1000"}),[l,u]=(0,s.useState)([]),d=async()=>{try{let t=await (0,c.Nv)("/admin/raffles");u(t.items)}catch(t){o.ZP.error(t instanceof Error?t.message:"خطا در دریافت قرعه کشی‌ها")}};(0,s.useEffect)(()=>{d()},[]);let h=async()=>{if(!r.title||!r.maxTickets){o.ZP.error("تمام فیلدهای ضروری را تکمیل کنید");return}try{await (0,c.Nv)("/admin/raffles",{method:"POST",body:JSON.stringify({title:r.title,maxTickets:Number(r.maxTickets)})}),o.ZP.success("قرعه کشی جدید ایجاد شد"),e(!1),i({title:"",maxTickets:"1000"}),await d()}catch(t){o.ZP.error(t instanceof Error?t.message:"خطا در ایجاد قرعه کشی")}},f=async(t,e)=>{try{await (0,c.Nv)("/admin/raffles/".concat(t,"/").concat(e),{method:"POST"}),o.ZP.success("وضعیت به‌روزرسانی شد"),await d()}catch(t){o.ZP.error(t instanceof Error?t.message:"خطا در تغییر وضعیت")}},m=async t=>{try{await (0,c.Nv)("/admin/raffles/".concat(t,"/draw"),{method:"POST",body:JSON.stringify({winnersCount:1,externalEntropy:"entropy-".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2))})}),o.ZP.success("Draw با موفقیت انجام شد"),await d()}catch(t){o.ZP.error(t instanceof Error?t.message:"خطا در draw")}};return(0,n.jsxs)("div",{className:"space-y-8",dir:"rtl",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("h1",{className:"text-4xl font-bold",children:"مدیریت قرعه کشی"}),(0,n.jsx)("button",{onClick:()=>e(!t),className:"btn-primary",children:"+ ایجاد قرعه کشی جدید"})]}),t&&(0,n.jsxs)(a.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"card glass p-8",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"تنظیم مبلغ و تعداد قرعه کشی"}),(0,n.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-dark-text/60 mb-2",children:"نام قرعه کشی"}),(0,n.jsx)("input",{type:"text",value:r.title,onChange:t=>i({...r,title:t.target.value}),className:"w-full bg-dark-bg/50 rounded-lg px-4 py-3 border border-dark-border text-dark-text"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-dark-text/60 mb-2",children:"تعداد کل بلیط"}),(0,n.jsx)("input",{type:"number",value:r.maxTickets,onChange:t=>i({...r,maxTickets:t.target.value}),className:"w-full bg-dark-bg/50 rounded-lg px-4 py-3 border border-dark-border text-dark-text"})]})]}),(0,n.jsxs)("div",{className:"flex gap-4",children:[(0,n.jsx)("button",{onClick:h,className:"btn-primary",children:"ثبت قرعه کشی"}),(0,n.jsx)("button",{onClick:()=>e(!1),className:"btn-tertiary",children:"انصراف"})]})]}),(0,n.jsx)("div",{className:"card glass overflow-hidden",children:(0,n.jsxs)("table",{className:"w-full",children:[(0,n.jsx)("thead",{className:"bg-dark-bg/50 border-b border-dark-border/30",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-6 py-4 text-right font-semibold",children:"نام"}),(0,n.jsx)("th",{className:"px-6 py-4 text-right font-semibold",children:"مبلغ پایه"}),(0,n.jsx)("th",{className:"px-6 py-4 text-right font-semibold",children:"فروخته شده"}),(0,n.jsx)("th",{className:"px-6 py-4 text-right font-semibold",children:"وضعیت"}),(0,n.jsx)("th",{className:"px-6 py-4 text-right font-semibold",children:"عملیات"})]})}),(0,n.jsx)("tbody",{children:l.map(t=>{var e,r;return(0,n.jsxs)("tr",{className:"border-b border-dark-border/10 hover:bg-dark-surface/30 transition-colors",children:[(0,n.jsx)("td",{className:"px-6 py-4",children:t.title}),(0,n.jsx)("td",{className:"px-6 py-4",children:(null!==(r=null===(e=t.tiers[0])||void 0===e?void 0:e.price)&&void 0!==r?r:0).toLocaleString("fa-IR")}),(0,n.jsxs)("td",{className:"px-6 py-4",children:[t.ticketsSold.toLocaleString("fa-IR")," / ",t.maxTickets.toLocaleString("fa-IR")]}),(0,n.jsx)("td",{className:"px-6 py-4",children:(0,n.jsx)("span",{className:"px-3 py-1 rounded-full bg-status-success/10 text-status-success text-sm",children:t.status})}),(0,n.jsxs)("td",{className:"px-6 py-4 flex gap-2",children:["draft"===t.status&&(0,n.jsx)("button",{onClick:()=>f(t.id,"open"),className:"btn-secondary text-sm px-3 py-2",children:"باز"}),"open"===t.status&&(0,n.jsx)("button",{onClick:()=>f(t.id,"close"),className:"btn-secondary text-sm px-3 py-2",children:"بستن"}),"closed"===t.status&&(0,n.jsx)("button",{onClick:()=>m(t.id),className:"btn-secondary text-sm px-3 py-2",children:"Draw"})]})]},t.id)})})]})})]})}},1837:function(t,e,r){"use strict";r.d(e,{Je:function(){return d},Nv:function(){return m},c8:function(){return x},hP:function(){return l},vD:function(){return u}});var n,a=r(257);let s=null!==(n=a.env.NEXT_PUBLIC_API_URL)&&void 0!==n?n:"http://localhost:4000/api/v1",o=a.env.NEXT_PUBLIC_API_GATEWAY_KEY,c="car_access_token",i="car_refresh_token";function l(){return localStorage.getItem(c)}function u(t){localStorage.setItem(c,t.accessToken),localStorage.setItem(i,t.refreshToken)}function d(){localStorage.removeItem(c),localStorage.removeItem(i)}async function h(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=new Headers(e.headers);void 0!==e.body&&null!==e.body&&n.set("Content-Type","application/json"),o&&n.set("x-api-gateway-key",o),r&&n.set("Authorization","Bearer ".concat(r));let a=await fetch("".concat(s).concat(t),{...e,headers:n});if(!a.ok){var c,i;let t=await a.json().catch(()=>({}));throw Error(null!==(i=null!==(c=t.error)&&void 0!==c?c:t.message)&&void 0!==i?i:"HTTP_".concat(a.status))}return 204===a.status?{}:await a.json()}async function f(){let t=localStorage.getItem(i);if(!t)return null;try{let e=await h("/auth/refresh",{method:"POST",body:JSON.stringify({refreshToken:t})});return u(e),e.accessToken}catch(t){return d(),null}}async function m(t){var e;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{auth:!0},a=null===(e=n.auth)||void 0===e||e,s=a?l():void 0;try{return await h(t,r,null!=s?s:void 0)}catch(n){if(!a)throw n;let e=await f();if(!e)throw n;return h(t,r,e)}}function x(){return"undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():"idemp-".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2))}}},function(t){t.O(0,[5186,4072,2971,2117,1744],function(){return t(t.s=6881)}),_N_E=t.O()}]);