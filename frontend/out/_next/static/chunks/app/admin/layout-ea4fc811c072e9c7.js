(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9091],{3258:function(e,t,a){Promise.resolve().then(a.bind(a,6631))},6631:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return A}});var l=a(7437),s=a(2265),n=a(7648),r=a(9376),i=a(5466),c=a(5805),o=a(8226),d=a(9474),h=a(370),x=a(7414),u=a(5287),m=a(8736),f=a(3578),b=a(1169),p=a(7662),w=a(3417),g=a(7656),N=a(7692),j=a(2489),v=a(8293),y=a(3247),k=a(4766),C=a(7766),Z=a(5186),S=a(1837);function A(e){var t;let{children:a}=e,[A,O]=(0,s.useState)(!1),[T,P]=(0,s.useState)(!1),[D,E]=(0,s.useState)([]),[_,M]=(0,s.useState)(0),z=(0,r.usePathname)(),J=(0,r.useRouter)(),{user:F,isLoading:I,logout:G}=(0,C.a)();(0,s.useEffect)(()=>{if(!I){if(!F){J.replace("/login");return}"admin"!==F.role&&J.replace("/dashboard")}},[I,F,J]),(0,s.useEffect)(()=>{F&&"admin"===F.role&&(async()=>{try{let e=await (0,S.Nv)("/me/notifications",{method:"GET"});E(e.items),M(e.unreadCount)}catch(e){}})()},[F]);let R=(0,s.useMemo)(()=>D.slice(0,8),[D]);async function H(e){try{await (0,S.Nv)("/me/notifications/".concat(e,"/read"),{method:"POST"}),E(t=>t.map(t=>{var a;return t.id===e?{...t,readAt:null!==(a=t.readAt)&&void 0!==a?a:new Date().toISOString()}:t})),M(e=>Math.max(0,e-1))}catch(e){}}async function L(){try{await (0,S.Nv)("/me/notifications/read-all",{method:"POST"});let e=new Date().toISOString();E(t=>t.map(t=>{var a;return{...t,readAt:null!==(a=t.readAt)&&void 0!==a?a:e}})),M(0)}catch(e){}}let q=[{label:"داشبورد",href:"/admin/dashboard",icon:i.Z},{label:"کاربران",href:"/admin/users",icon:c.Z},{label:"مدیریت مالی و کیف پول",href:"/admin/finance",icon:o.Z},{label:"مدیریت قرعه کشی",href:"/admin/raffles",icon:d.Z},{label:"تعرفه و قیمت گذاری",href:"/admin/pricing",icon:h.Z},{label:"بازی ها و شانس",href:"/admin/wheel",icon:x.Z},{label:"مانیتورینگ لایو",href:"/admin/live",icon:u.Z},{label:"قوانین و محتوا",href:"/admin/content",icon:m.Z},{label:"گزارش امنیت",href:"/admin/audit",icon:f.Z},{label:"مدیریت مزایده",href:"/admin/rewards",icon:b.Z},{label:"مدیریت نمایشگاه",href:"/admin/showroom",icon:p.Z},{label:"تیکت پشتیبانی",href:"/admin/support",icon:w.Z},{label:"قرعه کشی اسلاید",href:"/admin/slide",icon:g.Z}];return(0,l.jsxs)("div",{className:"min-h-screen bg-[#080808] text-white flex",dir:"rtl",children:[(0,l.jsx)("aside",{className:"\n        fixed lg:sticky top-0 h-screen z-50 bg-[#0C0C0C] border-l border-white/5 transition-all duration-300 overflow-hidden\n        ".concat(A?"w-72 right-0":"w-72 -right-72 lg:right-0","\n      "),children:(0,l.jsxs)("div",{className:"h-full flex flex-col p-6 min-h-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4 mb-12 px-2",children:[(0,l.jsx)("div",{className:"w-10 h-10 bg-accent-gold rounded-xl flex items-center justify-center",children:(0,l.jsx)(f.Z,{className:"w-6 h-6 text-black"})}),(0,l.jsxs)("h1",{className:"text-xl font-black tracking-tighter",children:["پنل ",(0,l.jsx)("span",{className:"text-accent-gold",children:"مدیریت"})]})]}),(0,l.jsx)("nav",{className:"flex-1 min-h-0 space-y-2 overflow-y-auto pr-1",children:q.map(e=>{let t=e.icon,a=z===e.href;return(0,l.jsxs)(n.default,{href:e.href,onClick:()=>O(!1),className:"\n                    flex items-center gap-4 px-4 py-3.5 rounded-2xl transition-all group\n                    ".concat(a?"bg-accent-gold text-black font-bold shadow-[0_0_20px_rgba(255,215,0,0.2)]":"hover:bg-white/5 text-white/50 hover:text-white","\n                  "),children:[(0,l.jsx)(t,{className:"w-5 h-5 ".concat(a?"text-black":"group-hover:scale-110 transition-transform")}),(0,l.jsx)("span",{className:"text-sm",children:e.label})]},e.href)})}),(0,l.jsx)("div",{className:"mt-auto pt-6 border-t border-white/5",children:(0,l.jsxs)("button",{className:"flex items-center gap-4 px-4 py-3.5 rounded-2xl text-red-500 hover:bg-red-500/10 transition-colors w-full",onClick:async()=>{await G(),Z.ZP.success("از پنل خارج شدید"),J.push("/login")},children:[(0,l.jsx)(N.Z,{className:"w-5 h-5"}),(0,l.jsx)("span",{className:"text-sm font-bold",children:"خروج از پنل"})]})})]})}),(0,l.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,l.jsxs)("header",{className:"h-20 border-b border-white/5 bg-[#080808]/80 backdrop-blur-xl sticky top-0 z-40 px-4 md:px-8 flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("button",{onClick:()=>O(!A),className:"lg:hidden p-2 hover:bg-white/5 rounded-xl transition-colors",children:A?(0,l.jsx)(j.Z,{}):(0,l.jsx)(v.Z,{})}),(0,l.jsxs)("div",{className:"hidden md:flex items-center gap-3 bg-white/5 px-4 py-2 rounded-xl border border-white/5 w-64 lg:w-96",children:[(0,l.jsx)(y.Z,{className:"w-4 h-4 text-white/30"}),(0,l.jsx)("input",{type:"text",placeholder:"جستجو در پنل مدیریت...",className:"bg-transparent border-none outline-none text-sm w-full placeholder:text-white/20"})]})]}),(0,l.jsxs)("div",{className:"relative flex items-center gap-3 md:gap-6",children:[(0,l.jsxs)("button",{onClick:()=>P(e=>!e),className:"relative p-2 hover:bg-white/5 rounded-xl transition-colors group",children:[(0,l.jsx)(k.Z,{className:"w-5 h-5 text-white/50 group-hover:text-white"}),_>0?(0,l.jsx)("span",{className:"absolute -top-1 -right-1 min-w-5 h-5 px-1 bg-[#D4AF37] text-black text-[10px] font-black rounded-full border border-[#080808] flex items-center justify-center",children:_>99?"99+":_}):null]}),T&&(0,l.jsxs)("div",{className:"absolute left-0 top-12 w-[360px] max-w-[92vw] bg-[#0A0A0A] border border-white/10 rounded-2xl p-4 shadow-2xl z-50",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsx)("p",{className:"font-black text-sm",children:"اعلان‌ها"}),(0,l.jsx)("button",{onClick:L,className:"text-xs text-accent-gold hover:underline",children:"خواندن همه"})]}),(0,l.jsxs)("div",{className:"max-h-80 overflow-y-auto space-y-2",children:[R.map(e=>(0,l.jsxs)("button",{onClick:()=>{e.readAt||H(e.id)},className:"w-full text-right p-3 rounded-xl border transition ".concat(e.readAt?"bg-white/5 border-white/10":"bg-[#D4AF37]/10 border-[#D4AF37]/30"),children:[(0,l.jsx)("p",{className:"text-sm font-bold",children:e.title}),e.body?(0,l.jsx)("p",{className:"text-xs text-white/60 mt-1",children:e.body}):null,(0,l.jsx)("p",{className:"text-[10px] text-white/40 mt-1",children:new Date(e.createdAt).toLocaleString("fa-IR")})]},e.id)),R.length?null:(0,l.jsx)("p",{className:"text-xs text-white/50 p-2",children:"اعلانی ندارید."})]})]}),(0,l.jsx)("div",{className:"h-8 w-px bg-white/10"}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsxs)("div",{className:"text-right hidden sm:block",children:[(0,l.jsx)("p",{className:"text-sm font-bold",children:"مدیر سیستم"}),(0,l.jsx)("p",{className:"text-[10px] text-white/30 uppercase tracking-widest",children:null!==(t=null==F?void 0:F.email)&&void 0!==t?t:"Admin"})]}),(0,l.jsx)("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-accent-gold to-yellow-600 p-px",children:(0,l.jsx)("div",{className:"w-full h-full rounded-[11px] bg-[#0C0C0C] flex items-center justify-center",children:(0,l.jsx)(c.Z,{className:"w-5 h-5 text-accent-gold"})})})]})]})]}),(0,l.jsx)("main",{className:"p-4 md:p-8 max-w-7xl mx-auto w-full",children:a})]}),A&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 lg:hidden",onClick:()=>O(!1)})]})}},7766:function(e,t,a){"use strict";a.d(t,{H:function(){return o},a:function(){return d}});var l=a(7437),s=a(2265),n=a(1837),r=a(5572);let i=(0,s.createContext)(null);async function c(){return(0,n.Nv)("/me",{method:"GET"},{auth:!0})}function o(e){let{children:t}=e,[a,o]=(0,s.useState)(null),[d,h]=(0,s.useState)(!0),x=(0,s.useCallback)(async()=>{try{let e=await c();o(e)}catch(e){o(null)}},[]);(0,s.useEffect)(()=>{let e=!0;return(async()=>{try{let t=await c();e&&o(t)}catch(t){e&&o(null)}finally{e&&h(!1)}})(),()=>{e=!1}},[]);let u=(0,s.useCallback)(async e=>{let{email:t,password:a}=e,l=await (0,n.Nv)("/auth/login",{method:"POST",body:JSON.stringify({email:t,password:a})},{auth:!1});return(0,n.vD)({accessToken:l.accessToken,refreshToken:l.refreshToken}),(0,r.DM)(l.user),o(l.user),l.user},[]),m=(0,s.useCallback)(async e=>{let{email:t,password:a,referralCode:l}=e;await (0,n.Nv)("/auth/register",{method:"POST",body:JSON.stringify({email:t,password:a,referralCode:l})},{auth:!1})},[]),f=(0,s.useCallback)(async()=>{try{await (0,n.Nv)("/auth/logout",{method:"POST",body:JSON.stringify({})})}catch(e){}finally{(0,n.Je)(),(0,r.DM)(null),o(null)}},[]),b=(0,s.useMemo)(()=>({user:a,isLoading:d,isAuthenticated:!!a,login:u,register:m,logout:f,refreshMe:x}),[a,d,u,m,f,x]);return(0,l.jsx)(i.Provider,{value:b,children:t})}function d(){let e=(0,s.useContext)(i);if(!e)throw Error("useAuth must be used within AuthProvider");return e}}},function(e){e.O(0,[5186,2972,6774,1837,2971,2117,1744],function(){return e(e.s=3258)}),_N_E=e.O()}]);