(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5861],{5110:function(e,t,r){Promise.resolve().then(r.bind(r,996))},257:function(e,t,r){"use strict";var s,i;e.exports=(null==(s=r.g.process)?void 0:s.env)&&"object"==typeof(null==(i=r.g.process)?void 0:i.env)?r.g.process:r(4227)},4227:function(e){!function(){var t={229:function(e){var t,r,s,i=e.exports={};function a(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function n(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{r="function"==typeof clearTimeout?clearTimeout:l}catch(e){r=l}}();var o=[],c=!1,d=-1;function u(){c&&s&&(c=!1,s.length?o=s.concat(o):d=-1,o.length&&h())}function h(){if(!c){var e=n(u);c=!0;for(var t=o.length;t;){for(s=o,o=[];++d<t;)s&&s[d].run();d=-1,t=o.length}s=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===l||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function p(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];o.push(new m(e,t)),1!==o.length||c||n(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},r={};function s(e){var i=r[e];if(void 0!==i)return i.exports;var a=r[e]={exports:{}},l=!0;try{t[e](a,a.exports,s),l=!1}finally{l&&delete r[e]}return a.exports}s.ab="//";var i=s(229);e.exports=i}()},996:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var s,i=r(7437),a=r(2265),l=r(5186),n=r(1837);let o=null!==(s=r(257).env.NEXT_PUBLIC_WS_URL)&&void 0!==s?s:"ws://localhost:4000/api/v1/live";function c(){let[e,t]=(0,a.useState)([]),[r,s]=(0,a.useState)([]),[c,d]=(0,a.useState)({title:"",imageUrl:"",sourceType:"external_purchase",listedPriceIrr:"",listedPriceGoldSot:"",acquisitionCostIrr:""});async function u(){try{let[e,r]=await Promise.all([(0,n.Nv)("/admin/showroom/vehicles"),(0,n.Nv)("/admin/showroom/orders")]);t(e.items),s(r.items)}catch(e){l.ZP.error(e instanceof Error?e.message:"خطا در دریافت نمایشگاه")}}(0,a.useEffect)(()=>{u()},[]),(0,a.useEffect)(()=>{let e=(0,n.hP)(),t=new WebSocket(e?"".concat(o,"?token=").concat(encodeURIComponent(e)):o);return t.onmessage=e=>{try{var t;let r=JSON.parse(e.data);if("event"!==r.type)return;let s=null===(t=r.payload)||void 0===t?void 0:t.type;("showroom.vehicle"===s||"showroom.order"===s)&&u()}catch(e){}},()=>t.close()},[]);let h=(0,a.useMemo)(()=>({available:e.filter(e=>"available"===e.status).length,sold:e.filter(e=>"sold"===e.status).length,ordersPaid:r.filter(e=>"paid"===e.status).length}),[e,r]);async function m(){if(!c.title.trim()||!c.imageUrl.trim())return l.ZP.error("عنوان و عکس لازم است");try{await (0,n.Nv)("/admin/showroom/vehicles",{method:"POST",body:JSON.stringify({title:c.title.trim(),imageUrl:c.imageUrl.trim(),sourceType:c.sourceType,listedPriceIrr:c.listedPriceIrr?Number(c.listedPriceIrr):void 0,listedPriceGoldSot:c.listedPriceGoldSot?Number(c.listedPriceGoldSot):void 0,acquisitionCostIrr:c.acquisitionCostIrr?Number(c.acquisitionCostIrr):void 0})}),d({title:"",imageUrl:"",sourceType:"external_purchase",listedPriceIrr:"",listedPriceGoldSot:"",acquisitionCostIrr:""}),l.ZP.success("خودرو به نمایشگاه اضافه شد"),await u()}catch(e){l.ZP.error(e instanceof Error?e.message:"ثبت خودرو ناموفق بود")}}async function p(e,t){try{await (0,n.Nv)("/admin/showroom/vehicles/".concat(e),{method:"PUT",body:JSON.stringify({status:t})}),await u()}catch(e){l.ZP.error(e instanceof Error?e.message:"تغییر وضعیت خودرو ناموفق بود")}}async function x(e,t){try{await (0,n.Nv)("/admin/showroom/orders/".concat(e,"/status"),{method:"POST",body:JSON.stringify({status:t})}),await u()}catch(e){l.ZP.error(e instanceof Error?e.message:"تغییر وضعیت سفارش ناموفق بود")}}return(0,i.jsxs)("div",{className:"space-y-6",dir:"rtl",children:[(0,i.jsx)("h1",{className:"text-3xl font-black",children:"مدیریت نمایشگاه و حواله خودرو"}),(0,i.jsxs)("section",{className:"grid md:grid-cols-3 gap-3",children:[(0,i.jsxs)("div",{className:"card glass p-4",children:["خودرو قابل خرید: ",h.available.toLocaleString("fa-IR")]}),(0,i.jsxs)("div",{className:"card glass p-4",children:["خودرو فروخته شده: ",h.sold.toLocaleString("fa-IR")]}),(0,i.jsxs)("div",{className:"card glass p-4",children:["سفارش پرداخت شده: ",h.ordersPaid.toLocaleString("fa-IR")]})]}),(0,i.jsxs)("section",{className:"card glass p-6 space-y-3",children:[(0,i.jsx)("h2",{className:"text-xl font-black",children:"افزودن خودرو"}),(0,i.jsxs)("div",{className:"grid md:grid-cols-3 gap-3",children:[(0,i.jsx)("input",{value:c.title,onChange:e=>d(t=>({...t,title:e.target.value})),className:"bg-black/30 border border-white/15 rounded-xl px-3 py-2",placeholder:"عنوان خودرو"}),(0,i.jsx)("input",{value:c.imageUrl,onChange:e=>d(t=>({...t,imageUrl:e.target.value})),className:"bg-black/30 border border-white/15 rounded-xl px-3 py-2",placeholder:"آدرس عکس"}),(0,i.jsxs)("select",{value:c.sourceType,onChange:e=>d(t=>({...t,sourceType:e.target.value})),className:"bg-black/30 border border-white/15 rounded-xl px-3 py-2",children:[(0,i.jsx)("option",{value:"external_purchase",children:"خرید مستقیم سایت"}),(0,i.jsx)("option",{value:"lottery_winback",children:"بازخرید از برنده"})]}),(0,i.jsx)("input",{value:c.listedPriceIrr,onChange:e=>d(t=>({...t,listedPriceIrr:e.target.value})),className:"bg-black/30 border border-white/15 rounded-xl px-3 py-2",placeholder:"قیمت تومان"}),(0,i.jsx)("input",{value:c.listedPriceGoldSot,onChange:e=>d(t=>({...t,listedPriceGoldSot:e.target.value})),className:"bg-black/30 border border-white/15 rounded-xl px-3 py-2",placeholder:"قیمت سوت"}),(0,i.jsx)("input",{value:c.acquisitionCostIrr,onChange:e=>d(t=>({...t,acquisitionCostIrr:e.target.value})),className:"bg-black/30 border border-white/15 rounded-xl px-3 py-2",placeholder:"هزینه تملک"})]}),(0,i.jsx)("button",{onClick:m,className:"btn-primary",children:"ثبت خودرو"})]}),(0,i.jsxs)("section",{className:"card glass p-6",children:[(0,i.jsx)("h2",{className:"text-xl font-black mb-3",children:"خودروها"}),(0,i.jsxs)("div",{className:"space-y-2",children:[e.map(e=>{var t,r,s,a;return(0,i.jsxs)("div",{className:"p-3 rounded-xl border border-white/10 bg-black/20 flex flex-wrap items-center justify-between gap-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-bold",children:String(null!==(r=null===(t=e.vehicle)||void 0===t?void 0:t.title)&&void 0!==r?r:e.id)}),(0,i.jsxs)("p",{className:"text-xs text-white/60",children:[e.status," | IRR: ",null!==(s=e.listedPriceIrr)&&void 0!==s?s:"-"," | SOT: ",null!==(a=e.listedPriceGoldSot)&&void 0!==a?a:"-"]})]}),(0,i.jsx)("div",{className:"flex gap-2",children:["available","reserved","sold","archived"].map(t=>(0,i.jsx)("button",{onClick:()=>void p(e.id,t),className:"px-3 py-1 rounded-lg text-xs border ".concat(e.status===t?"border-accent-gold text-accent-gold":"border-white/20 text-white/70"),children:t},t))})]},e.id)}),e.length?null:(0,i.jsx)("p",{className:"text-sm text-white/50",children:"خودرویی ثبت نشده است."})]})]}),(0,i.jsxs)("section",{className:"card glass p-6",children:[(0,i.jsx)("h2",{className:"text-xl font-black mb-3",children:"سفارش‌ها"}),(0,i.jsxs)("div",{className:"space-y-2",children:[r.map(e=>(0,i.jsxs)("div",{className:"p-3 rounded-xl border border-white/10 bg-black/20 flex flex-wrap items-center justify-between gap-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-bold",children:e.vehicleTitle}),(0,i.jsxs)("p",{className:"text-xs text-white/60",children:[e.buyerEmail," | ",e.paymentAsset," | ",e.paymentAmount.toLocaleString("fa-IR")," | ",e.status]})]}),(0,i.jsx)("div",{className:"flex gap-2",children:["pending","paid","completed","cancelled"].map(t=>(0,i.jsx)("button",{onClick:()=>void x(e.id,t),className:"px-3 py-1 rounded-lg text-xs border ".concat(e.status===t?"border-accent-gold text-accent-gold":"border-white/20 text-white/70"),children:t},t))})]},e.id)),r.length?null:(0,i.jsx)("p",{className:"text-sm text-white/50",children:"سفارشی وجود ندارد."})]})]})]})}}},function(e){e.O(0,[5186,1837,2971,2117,1744],function(){return e(e.s=5110)}),_N_E=e.O()}]);