(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7663],{2656:function(e,t,a){Promise.resolve().then(a.bind(a,7123))},7123:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return _}});var n=a(7437),r=a(2265),s=a(7648),l=a(9376),i=a(4072),c=a(5466),o=a(5080),d=a(5621),u=a(3618),h=a(1804),x=a(5187),f=a(5021),m=a(7662),b=a(2369),p=a(4286),g=a(2451),w=a(2489),v=a(7692),N=a(8293),j=a(4766),y=a(7766),k=a(5186),A=a(1837),S=a(7921);function _(e){var t,a;let{children:_}=e,[C,T]=(0,r.useState)(!1),[D,Z]=(0,r.useState)(!1),[I,P]=(0,r.useState)([]),[O,E]=(0,r.useState)(0),F=(0,l.usePathname)(),z=(0,l.useRouter)(),{user:U,isLoading:L,logout:J}=(0,y.a)();(0,r.useEffect)(()=>{L||U||z.replace("/login")},[L,U,z]),(0,r.useEffect)(()=>{U&&(async()=>{try{let e=await (0,A.Nv)("/me/notifications",{method:"GET"});P(e.items),E(e.unreadCount)}catch(e){}})()},[U]);let M=(0,r.useMemo)(()=>I.slice(0,8),[I]);async function B(e){try{await (0,A.Nv)("/me/notifications/".concat(e,"/read"),{method:"POST"}),P(t=>t.map(t=>{var a;return t.id===e?{...t,readAt:null!==(a=t.readAt)&&void 0!==a?a:new Date().toISOString()}:t})),E(e=>Math.max(0,e-1))}catch(e){}}async function R(){try{await (0,A.Nv)("/me/notifications/read-all",{method:"POST"});let e=new Date().toISOString();P(t=>t.map(t=>{var a;return{...t,readAt:null!==(a=t.readAt)&&void 0!==a?a:e}})),E(0)}catch(e){}}let G=[{label:"داشبورد",href:"/dashboard",icon:c.Z},{label:"خرید بلیط",href:"/raffles",icon:o.Z},{label:"تاریخچه بلیط ها",href:"/dashboard/tickets",icon:d.Z},{label:"ماشین حساب سود",href:"/dashboard/calculator",icon:u.Z},{label:"کیف پول و شارژ",href:"/dashboard/wallet",icon:h.Z},{label:"کش بک و برداشت",href:"/wallet",icon:x.Z},{label:"گردونه شانس",href:"/wheel",icon:f.Z},{label:"قرعه‌کشی ماشین اسلاید",href:"/slide-game",icon:m.Z},{label:"بازی ماشین اسلاید",href:"/slide-arena",icon:m.Z},{label:"زیرمجموعه گیری",href:"/dashboard/referral",icon:b.Z},{label:"تاریخچه جوایز",href:"/dashboard/history",icon:o.Z},{label:"قوانین و مقررات",href:"/dashboard/rules",icon:p.Z}];return(0,n.jsxs)("div",{className:"min-h-screen bg-[#050505] text-white flex",children:[(0,n.jsx)("aside",{className:"\n        fixed lg:sticky top-0 h-screen z-50 bg-[#0A0A0A] border-l border-white/5 transition-all duration-300 ease-in-out\n        w-72 ".concat(C?"right-0":"-right-72 lg:right-0","\n      "),children:(0,n.jsxs)("div",{className:"h-full flex flex-col p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-12 px-2",children:[(0,n.jsxs)(s.default,{href:"/",className:"flex items-center gap-3 group",children:[(0,n.jsx)("div",{className:"w-10 h-10 bg-[#D4AF37] rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform shadow-[0_0_15px_rgba(212,175,55,0.3)]",children:(0,n.jsx)(g.Z,{className:"w-6 h-6 text-black"})}),(0,n.jsxs)("h1",{className:"text-xl font-black tracking-tighter",children:["LUX",(0,n.jsx)("span",{className:"text-[#D4AF37]",children:"."})]})]}),(0,n.jsx)("button",{onClick:()=>T(!1),className:"lg:hidden p-2 hover:bg-white/5 rounded-xl transition-colors text-white/40 hover:text-white",children:(0,n.jsx)(w.Z,{size:20})})]}),(0,n.jsx)("nav",{className:"flex-1 space-y-2",children:G.map(e=>{let t=e.icon,a=F===e.href;return(0,n.jsxs)(s.default,{href:e.href,onClick:()=>T(!1),className:"\n                    flex items-center gap-4 px-4 py-3.5 rounded-2xl transition-all group relative\n                    ".concat(a?"bg-[#D4AF37] text-black font-bold shadow-[0_10px_20px_-5px_rgba(212,175,55,0.3)]":"hover:bg-white/5 text-white/40 hover:text-white","\n                  "),children:[(0,n.jsx)(t,{className:"w-5 h-5 ".concat(a?"text-black":"group-hover:scale-110 transition-transform")}),(0,n.jsx)("span",{className:"text-sm",children:e.label}),a&&(0,n.jsx)(i.E.div,{layoutId:"activeTab",className:"absolute inset-0 bg-[#D4AF37] rounded-2xl -z-10"})]},e.href)})}),(0,n.jsx)("div",{className:"mt-auto pt-6 border-t border-white/5",children:(0,n.jsxs)("button",{className:"flex items-center gap-4 px-4 py-3.5 rounded-2xl text-rose-500 hover:bg-rose-500/10 transition-colors w-full",onClick:async()=>{await J(),k.ZP.success("از حساب خارج شدید"),z.push("/login")},children:[(0,n.jsx)(v.Z,{className:"w-5 h-5"}),(0,n.jsx)("span",{className:"text-sm font-bold",children:"خروج از حساب"})]})})]})}),(0,n.jsxs)("div",{className:"flex-1 flex flex-col min-w-0 h-screen overflow-y-auto",children:[(0,n.jsxs)("header",{className:"h-20 border-b border-white/5 bg-[#050505]/80 backdrop-blur-xl sticky top-0 z-40 px-4 md:px-8 flex items-center justify-between shrink-0",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)("button",{onClick:()=>T(!C),className:"lg:hidden p-2 hover:bg-white/5 rounded-xl transition-colors text-[#D4AF37]",children:C?(0,n.jsx)(w.Z,{size:24}):(0,n.jsx)(N.Z,{size:24})}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-8 h-8 rounded-full bg-[#D4AF37]/10 flex items-center justify-center border border-[#D4AF37]/20",children:(0,n.jsx)(b.Z,{size:14,className:"text-[#D4AF37]"})}),(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("span",{className:"text-white/20 text-[10px] leading-none mb-1",children:"پنل کاربری"}),(0,n.jsxs)("span",{className:"text-xs font-bold text-white",children:["خوش آمدید، ",null!==(t=null==U?void 0:U.email)&&void 0!==t?t:"کاربر"," "]})]})]})]}),(0,n.jsxs)("div",{className:"relative flex items-center gap-3 md:gap-6",children:[(0,n.jsxs)("div",{className:"hidden md:flex items-center gap-4 bg-white/5 px-4 py-2 rounded-xl border border-white/5",children:[(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("p",{className:"text-[10px] text-white/40 font-bold uppercase tracking-widest leading-none mb-1",children:"موجودی کیف پول"}),(0,n.jsxs)("p",{className:"text-sm font-black text-[#D4AF37]",children:[(0,S.d)(null!==(a=null==U?void 0:U.walletBalance)&&void 0!==a?a:0)," تومان"]})]}),(0,n.jsx)(s.default,{href:"/dashboard/wallet",className:"w-8 h-8 bg-[#D4AF37] rounded-lg flex items-center justify-center hover:scale-105 transition-transform",children:(0,n.jsx)(h.Z,{className:"w-4 h-4 text-black"})})]}),(0,n.jsxs)("button",{onClick:()=>Z(e=>!e),className:"relative p-2 hover:bg-white/5 rounded-xl transition-colors group",children:[(0,n.jsx)(j.Z,{size:20,className:"text-white/40 group-hover:text-white transition-colors"}),O>0?(0,n.jsx)("span",{className:"absolute -top-1 -right-1 min-w-5 h-5 px-1 bg-[#D4AF37] text-black text-[10px] font-black rounded-full border border-[#050505] flex items-center justify-center",children:O>99?"99+":O}):null]}),D&&(0,n.jsxs)("div",{className:"absolute left-4 md:left-8 top-20 w-[360px] max-w-[92vw] bg-[#0A0A0A] border border-white/10 rounded-2xl p-4 shadow-2xl z-50",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsx)("p",{className:"font-black text-sm",children:"اعلان‌ها"}),(0,n.jsx)("button",{onClick:R,className:"text-xs text-accent-gold hover:underline",children:"خواندن همه"})]}),(0,n.jsxs)("div",{className:"max-h-80 overflow-y-auto space-y-2",children:[M.map(e=>(0,n.jsxs)("button",{onClick:()=>{e.readAt||B(e.id)},className:"w-full text-right p-3 rounded-xl border transition ".concat(e.readAt?"bg-white/5 border-white/10":"bg-[#D4AF37]/10 border-[#D4AF37]/30"),children:[(0,n.jsx)("p",{className:"text-sm font-bold",children:e.title}),e.body?(0,n.jsx)("p",{className:"text-xs text-white/60 mt-1",children:e.body}):null,(0,n.jsx)("p",{className:"text-[10px] text-white/40 mt-1",children:new Date(e.createdAt).toLocaleString("fa-IR")})]},e.id)),M.length?null:(0,n.jsx)("p",{className:"text-xs text-white/50 p-2",children:"اعلانی ندارید."})]})]})]})]}),(0,n.jsx)("main",{className:"p-4 md:p-8",children:_})]}),C&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 lg:hidden",onClick:()=>T(!1)})]})}},1837:function(e,t,a){"use strict";a.d(t,{Je:function(){return u},Nv:function(){return f},c8:function(){return m},hP:function(){return o},vD:function(){return d}});var n,r=a(257);let s=null!==(n=r.env.NEXT_PUBLIC_API_URL)&&void 0!==n?n:"http://localhost:4000/api/v1",l=r.env.NEXT_PUBLIC_API_GATEWAY_KEY,i="car_access_token",c="car_refresh_token";function o(){return localStorage.getItem(i)}function d(e){localStorage.setItem(i,e.accessToken),localStorage.setItem(c,e.refreshToken)}function u(){localStorage.removeItem(i),localStorage.removeItem(c)}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0,n=new Headers(t.headers);void 0!==t.body&&null!==t.body&&n.set("Content-Type","application/json"),l&&n.set("x-api-gateway-key",l),a&&n.set("Authorization","Bearer ".concat(a));let r=await fetch("".concat(s).concat(e),{...t,headers:n});if(!r.ok){var i,c;let e=await r.json().catch(()=>({}));throw Error(null!==(c=null!==(i=e.error)&&void 0!==i?i:e.message)&&void 0!==c?c:"HTTP_".concat(r.status))}return 204===r.status?{}:await r.json()}async function x(){let e=localStorage.getItem(c);if(!e)return null;try{let t=await h("/auth/refresh",{method:"POST",body:JSON.stringify({refreshToken:e})});return d(t),t.accessToken}catch(e){return u(),null}}async function f(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{auth:!0},r=null===(t=n.auth)||void 0===t||t,s=r?o():void 0;try{return await h(e,a,null!=s?s:void 0)}catch(n){if(!r)throw n;let t=await x();if(!t)throw n;return h(e,a,t)}}function m(){return"undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():"idemp-".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2))}},7766:function(e,t,a){"use strict";a.d(t,{H:function(){return c},a:function(){return o}});var n=a(7437),r=a(2265),s=a(1837);let l=(0,r.createContext)(null);async function i(){return(0,s.Nv)("/me",{method:"GET"},{auth:!0})}function c(e){let{children:t}=e,[a,c]=(0,r.useState)(null),[o,d]=(0,r.useState)(!0),u=(0,r.useCallback)(async()=>{c(await i())},[]);(0,r.useEffect)(()=>{let e=!0;return(async()=>{try{let t=await i();e&&c(t)}catch(t){e&&c(null)}finally{e&&d(!1)}})(),()=>{e=!1}},[]);let h=(0,r.useCallback)(async e=>{let{email:t,password:a}=e,n=await (0,s.Nv)("/auth/login",{method:"POST",body:JSON.stringify({email:t,password:a})},{auth:!1});return(0,s.vD)({accessToken:n.accessToken,refreshToken:n.refreshToken}),c(n.user),n.user},[]),x=(0,r.useCallback)(async e=>{let{email:t,password:a,referralCode:n}=e;await (0,s.Nv)("/auth/register",{method:"POST",body:JSON.stringify({email:t,password:a,referralCode:n})},{auth:!1})},[]),f=(0,r.useCallback)(async()=>{try{let e=localStorage.getItem("car_refresh_token");e&&await (0,s.Nv)("/auth/logout",{method:"POST",body:JSON.stringify({refreshToken:e})})}catch(e){}finally{(0,s.Je)(),c(null)}},[]),m=(0,r.useMemo)(()=>({user:a,isLoading:o,isAuthenticated:!!a,login:h,register:x,logout:f,refreshMe:u}),[a,o,h,x,f,u]);return(0,n.jsx)(l.Provider,{value:m,children:t})}function o(){let e=(0,r.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},7921:function(e,t,a){"use strict";function n(e){return(Number.isFinite(e)?Math.trunc(e):0).toLocaleString("fa-IR")}function r(e){if(!e.trim())return null;let t=e.split("").map(e=>{let t="۰۱۲۳۴۵۶۷۸۹".indexOf(e);if(t>=0)return String(t);let a="٠١٢٣٤٥٦٧٨٩".indexOf(e);return a>=0?String(a):e}).join("").toLowerCase().replace(/,/g,"").trim(),a=t.includes("million")||t.includes("میلیون")||/\d+(\.\d+)?\s*m\b/.test(t),n=Number(t.replace(/[^\d.]/g,""));if(!Number.isFinite(n)||n<=0)return null;let r=Math.trunc(a?1e6*n:n);return r<=0?null:r}a.d(t,{C:function(){return r},d:function(){return n}})}},function(e){e.O(0,[5186,4072,2972,3694,2971,2117,1744],function(){return e(e.s=2656)}),_N_E=e.O()}]);