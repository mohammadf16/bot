(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4869],{4078:function(e,t,r){Promise.resolve().then(r.bind(r,7071))},257:function(e,t,r){"use strict";var n,a;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(a=r.g.process)?void 0:a.env)?r.g.process:r(4227)},4227:function(e){!function(){var t={229:function(e){var t,r,n,a=e.exports={};function s(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var i=[],l=!1,u=-1;function d(){l&&n&&(l=!1,n.length?i=n.concat(i):u=-1,i.length&&h())}function h(){if(!l){var e=c(d);l=!0;for(var t=i.length;t;){for(n=i,i=[];++u<t;)n&&n[u].run();u=-1,t=i.length}n=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];i.push(new f(e,t)),1!==i.length||l||c(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=m,a.addListener=m,a.once=m,a.off=m,a.removeListener=m,a.removeAllListeners=m,a.emit=m,a.prependListener=m,a.prependOnceListener=m,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var s=r[e]={exports:{}},o=!0;try{t[e](s,s.exports,n),o=!1}finally{o&&delete r[e]}return s.exports}n.ab="//";var a=n(229);e.exports=a}()},7071:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var n=r(7437),a=r(2265),s=r(5186),o=r(1837),c=r(7766);function i(){let{isAuthenticated:e}=(0,c.a)(),[t,r]=(0,a.useState)([]),[i,l]=(0,a.useState)(""),[u,d]=(0,a.useState)(1),[h,f]=(0,a.useState)(null),m=(0,a.useMemo)(()=>{var e;return null!==(e=t.find(e=>e.id===i))&&void 0!==e?e:null},[t,i]);async function p(){try{let e=await (0,o.Nv)("/raffles",{method:"GET"},{auth:!1});r(e.items);let t=e.items.find(e=>"open"===e.status);l(r=>{var n;return r||(null==t?void 0:t.id)||(null===(n=e.items[0])||void 0===n?void 0:n.id)||""})}catch(e){s.ZP.error(e instanceof Error?e.message:"خطا در دریافت قرعه کشی")}}async function v(){if(m){if(!e)return s.ZP.error("ابتدا وارد شوید");try{let e=await (0,o.Nv)("/raffles/".concat(m.id,"/buy"),{method:"POST",headers:{"Idempotency-Key":(0,o.c8)()},body:JSON.stringify({count:u})});f(e),s.ZP.success("خرید با قیمت پویا انجام شد"),await p()}catch(e){s.ZP.error(e instanceof Error?e.message:"خرید انجام نشد")}}}async function x(t){if(m){if(!e)return s.ZP.error("ابتدا وارد شوید");try{await (0,o.Nv)("/raffles/".concat(m.id,"/buy-combo"),{method:"POST",body:JSON.stringify({code:t})}),s.ZP.success("پکیج ".concat("silver"===t?"نقره ای":"طلایی"," خریداری شد")),await p()}catch(e){s.ZP.error(e instanceof Error?e.message:"خرید پکیج انجام نشد")}}}return(0,a.useEffect)(()=>{p()},[]),(0,n.jsx)("main",{className:"min-h-screen bg-dark-bg pt-32 pb-20 text-right",dir:"rtl",children:(0,n.jsxs)("div",{className:"max-w-6xl mx-auto px-4 space-y-8",children:[(0,n.jsxs)("section",{className:"card glass p-8",children:[(0,n.jsx)("h1",{className:"text-4xl font-black mb-3",children:"قرعه کشی هوشمند"}),(0,n.jsx)("p",{className:"text-dark-text/70",children:"قیمت پویا: قیمت پایه \xd7 (0.8)^(تعداد خرید - 1) با کف ۵۰٪"})]}),(0,n.jsxs)("section",{className:"card glass p-8",children:[(0,n.jsx)("label",{className:"text-sm text-dark-text/60 mb-2 block",children:"انتخاب قرعه کشی"}),(0,n.jsx)("select",{value:i,onChange:e=>l(e.target.value),className:"w-full bg-dark-bg/50 border border-dark-border/40 rounded-xl px-3 py-3 mb-4",children:t.map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.title," (",e.status,")"]},e.id))}),m?(0,n.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"bg-black/20 rounded-xl border border-white/10 p-4 text-sm",children:[(0,n.jsxs)("p",{children:["بلیط فروخته شده: ",(0,n.jsx)("b",{children:m.ticketsSold.toLocaleString("fa-IR")})]}),(0,n.jsxs)("p",{children:["باقیمانده: ",(0,n.jsx)("b",{children:(m.maxTickets-m.ticketsSold).toLocaleString("fa-IR")})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm text-dark-text/60 mb-2 block",children:"تعداد بلیط تکی"}),(0,n.jsx)("select",{value:u,onChange:e=>d(Number(e.target.value)),className:"w-full bg-dark-bg/50 border border-dark-border/40 rounded-xl px-3 py-3",children:Array.from({length:20},(e,t)=>t+1).map(e=>(0,n.jsx)("option",{value:e,children:e.toLocaleString("fa-IR")},e))})]}),(0,n.jsx)("button",{onClick:v,className:"btn-primary w-full",children:"خرید تکی (قیمت پویا)"})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("h3",{className:"font-black",children:"پکیج های ترکیبی"}),m.comboPackages.map(e=>(0,n.jsxs)("div",{className:"bg-black/20 rounded-xl border border-white/10 p-4",children:[(0,n.jsx)("p",{className:"font-bold",children:"silver"===e.code?"پکیج نقره ای":"پکیج طلایی"}),(0,n.jsxs)("p",{className:"text-sm text-white/70",children:[e.paidTickets," خرید + ",e.bonusTickets," هدیه + ",e.bonusChances," شانس"]}),e.vipDays>0?(0,n.jsxs)("p",{className:"text-xs text-amber-300 mt-1",children:["+ ",e.vipDays," روز VIP"]}):null,(0,n.jsx)("button",{className:"btn-secondary mt-3",onClick:()=>x(e.code),children:"خرید پکیج"})]},e.code)),h?(0,n.jsxs)("div",{className:"bg-emerald-500/10 border border-emerald-500/30 rounded-xl p-4 text-sm",children:[(0,n.jsxs)("p",{children:["جمع پرداخت: ",(0,n.jsx)("b",{children:h.totalPaid.toLocaleString("fa-IR")})," تومان"]}),(0,n.jsxs)("p",{children:["کش بک: ",(0,n.jsx)("b",{children:h.cashback.toLocaleString("fa-IR")})," تومان"]}),h.pity?(0,n.jsxs)("p",{children:["حافظه شانس: x",h.pity.pityMultiplier.toFixed(2)]}):null]}):null]})]}):null]})]})})}},1837:function(e,t,r){"use strict";r.d(t,{Je:function(){return d},Nv:function(){return m},c8:function(){return p},hP:function(){return l},vD:function(){return u}});var n,a=r(257);let s=null!==(n=a.env.NEXT_PUBLIC_API_URL)&&void 0!==n?n:"http://localhost:4000/api/v1",o=a.env.NEXT_PUBLIC_API_GATEWAY_KEY,c="car_access_token",i="car_refresh_token";function l(){return localStorage.getItem(c)}function u(e){localStorage.setItem(c,e.accessToken),localStorage.setItem(i,e.refreshToken)}function d(){localStorage.removeItem(c),localStorage.removeItem(i)}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=new Headers(t.headers);void 0!==t.body&&null!==t.body&&n.set("Content-Type","application/json"),o&&n.set("x-api-gateway-key",o),r&&n.set("Authorization","Bearer ".concat(r));let a=await fetch("".concat(s).concat(e),{...t,headers:n});if(!a.ok){var c,i;let e=await a.json().catch(()=>({}));throw Error(null!==(i=null!==(c=e.error)&&void 0!==c?c:e.message)&&void 0!==i?i:"HTTP_".concat(a.status))}return 204===a.status?{}:await a.json()}async function f(){let e=localStorage.getItem(i);if(!e)return null;try{let t=await h("/auth/refresh",{method:"POST",body:JSON.stringify({refreshToken:e})});return u(t),t.accessToken}catch(e){return d(),null}}async function m(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{auth:!0},a=null===(t=n.auth)||void 0===t||t,s=a?l():void 0;try{return await h(e,r,null!=s?s:void 0)}catch(n){if(!a)throw n;let t=await f();if(!t)throw n;return h(e,r,t)}}function p(){return"undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():"idemp-".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2))}},7766:function(e,t,r){"use strict";r.d(t,{H:function(){return i},a:function(){return l}});var n=r(7437),a=r(2265),s=r(1837);let o=(0,a.createContext)(null);async function c(){return(0,s.Nv)("/me",{method:"GET"},{auth:!0})}function i(e){let{children:t}=e,[r,i]=(0,a.useState)(null),[l,u]=(0,a.useState)(!0),d=(0,a.useCallback)(async()=>{i(await c())},[]);(0,a.useEffect)(()=>{let e=!0;return(async()=>{try{let t=await c();e&&i(t)}catch(t){e&&i(null)}finally{e&&u(!1)}})(),()=>{e=!1}},[]);let h=(0,a.useCallback)(async e=>{let{email:t,password:r}=e,n=await (0,s.Nv)("/auth/login",{method:"POST",body:JSON.stringify({email:t,password:r})},{auth:!1});return(0,s.vD)({accessToken:n.accessToken,refreshToken:n.refreshToken}),i(n.user),n.user},[]),f=(0,a.useCallback)(async e=>{let{email:t,password:r,referralCode:n}=e;await (0,s.Nv)("/auth/register",{method:"POST",body:JSON.stringify({email:t,password:r,referralCode:n})},{auth:!1})},[]),m=(0,a.useCallback)(async()=>{try{let e=localStorage.getItem("car_refresh_token");e&&await (0,s.Nv)("/auth/logout",{method:"POST",body:JSON.stringify({refreshToken:e})})}catch(e){}finally{(0,s.Je)(),i(null)}},[]),p=(0,a.useMemo)(()=>({user:r,isLoading:l,isAuthenticated:!!r,login:h,register:f,logout:m,refreshMe:d}),[r,l,h,f,m,d]);return(0,n.jsx)(o.Provider,{value:p,children:t})}function l(){let e=(0,a.useContext)(o);if(!e)throw Error("useAuth must be used within AuthProvider");return e}}},function(e){e.O(0,[5186,2971,2117,1744],function(){return e(e.s=4078)}),_N_E=e.O()}]);