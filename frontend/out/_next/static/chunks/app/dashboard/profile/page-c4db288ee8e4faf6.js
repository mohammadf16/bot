(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5544],{3536:function(e,t,r){Promise.resolve().then(r.bind(r,4916))},8755:function(e,t,r){"use strict";r.d(t,{Z:function(){return d}});var n=r(2265);let a=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()},i=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),s=e=>{let t=l(e);return t.charAt(0).toUpperCase()+t.slice(1)};var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let c=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0;return!1},u=(0,n.forwardRef)((e,t)=>{let{color:r="currentColor",size:i=24,strokeWidth:l=2,absoluteStrokeWidth:s,className:u="",children:d,iconNode:h,...f}=e;return(0,n.createElement)("svg",{ref:t,...o,width:i,height:i,stroke:r,strokeWidth:s?24*Number(l)/Number(i):l,className:a("lucide",u),...!d&&!c(f)&&{"aria-hidden":"true"},...f},[...h.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),d=(e,t)=>{let r=(0,n.forwardRef)((r,l)=>{let{className:o,...c}=r;return(0,n.createElement)(u,{ref:l,iconNode:t,className:a("lucide-".concat(i(s(e))),"lucide-".concat(e),o),...c})});return r.displayName=s(e),r}},4766:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(8755).Z)("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]])},9345:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(8755).Z)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]])},3041:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(8755).Z)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]])},3229:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(8755).Z)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},2369:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(8755).Z)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},257:function(e,t,r){"use strict";var n,a;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(a=r.g.process)?void 0:a.env)?r.g.process:r(4227)},4227:function(e){!function(){var t={229:function(e){var t,r,n,a=e.exports={};function i(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{r="function"==typeof clearTimeout?clearTimeout:l}catch(e){r=l}}();var o=[],c=!1,u=-1;function d(){c&&n&&(c=!1,n.length?o=n.concat(o):u=-1,o.length&&h())}function h(){if(!c){var e=s(d);c=!0;for(var t=o.length;t;){for(n=o,o=[];++u<t;)n&&n[u].run();u=-1,t=o.length}n=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===l||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];o.push(new f(e,t)),1!==o.length||c||s(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=m,a.addListener=m,a.once=m,a.off=m,a.removeListener=m,a.removeAllListeners=m,a.emit=m,a.prependListener=m,a.prependOnceListener=m,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var i=r[e]={exports:{}},l=!0;try{t[e](i,i.exports,n),l=!1}finally{l&&delete r[e]}return i.exports}n.ab="//";var a=n(229);e.exports=a}()},4916:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return y}});var n=r(7437),a=r(2265),i=r(4072),l=r(2369),s=r(3041),o=r(8755);let c=(0,o.Z)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),u=(0,o.Z)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var d=r(9345),h=r(4766);let f=(0,o.Z)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);var m=r(3229),p=r(5186),x=r(1837),v=r(7766);function y(){var e;let{user:t,refreshMe:r}=(0,v.a)(),[o,y]=(0,a.useState)(!0),[w,N]=(0,a.useState)(!1),[j,k]=(0,a.useState)({fullName:"",username:"",phone:"",city:"",address:"",bio:"",avatarUrl:"",notificationPrefs:{email:!0,sms:!1,push:!0}});async function T(){y(!0);try{var e,t,r,n,a,i,l,s;let o=await (0,x.Nv)("/me/profile",{method:"GET"});k({fullName:null!==(e=o.profile.fullName)&&void 0!==e?e:"",username:null!==(t=o.profile.username)&&void 0!==t?t:"",phone:null!==(r=o.profile.phone)&&void 0!==r?r:"",city:null!==(n=o.profile.city)&&void 0!==n?n:"",address:null!==(a=o.profile.address)&&void 0!==a?a:"",bio:null!==(i=o.profile.bio)&&void 0!==i?i:"",avatarUrl:null!==(l=o.profile.avatarUrl)&&void 0!==l?l:"",notificationPrefs:null!==(s=o.notificationPrefs)&&void 0!==s?s:{email:!0,sms:!1,push:!0}})}catch(e){p.ZP.error(e instanceof Error?e.message:"خطا در دریافت اطلاعات پروفایل")}finally{y(!1)}}(0,a.useEffect)(()=>{T()},[]);let C=(0,a.useMemo)(()=>(j.fullName||(null==t?void 0:t.email)||"کاربر").slice(0,1).toUpperCase(),[j.fullName,null==t?void 0:t.email]);async function A(){N(!0);try{await (0,x.Nv)("/me/profile",{method:"PATCH",body:JSON.stringify({fullName:j.fullName||void 0,username:j.username||void 0,phone:j.phone||void 0,city:j.city||void 0,address:j.address||void 0,bio:j.bio||void 0,avatarUrl:j.avatarUrl||void 0,notificationPrefs:j.notificationPrefs})}),await r(),p.ZP.success("پروفایل با موفقیت ذخیره شد")}catch(e){p.ZP.error(e instanceof Error?e.message:"خطا در ذخیره پروفایل")}finally{N(!1)}}return(0,n.jsxs)("div",{className:"space-y-8",dir:"rtl",children:[(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-black",children:"پروفایل کاربری"}),(0,n.jsx)("p",{className:"text-white/40 text-sm mt-1",children:"اطلاعات حساب، هویت و اعلان‌ها را مدیریت کنید."})]})}),(0,n.jsxs)("div",{className:"grid lg:grid-cols-[320px,1fr] gap-6",children:[(0,n.jsx)(i.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-[#0A0A0A] border border-white/5 rounded-[2rem] p-6",children:(0,n.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,n.jsx)("div",{className:"w-24 h-24 rounded-full bg-white/10 border border-white/20 flex items-center justify-center text-3xl font-black text-accent-gold",children:C}),(0,n.jsx)("p",{className:"mt-4 font-black",children:j.fullName||"بدون نام"}),(0,n.jsx)("p",{className:"text-xs text-white/40 mt-1",children:null==t?void 0:t.email}),(0,n.jsxs)("div",{className:"mt-4 w-full bg-white/5 rounded-xl p-3 border border-white/10 text-xs text-white/70",children:["سطح دسترسی: ",(null==t?void 0:t.role)==="admin"?"مدیر":"کاربر"]})]})}),(0,n.jsxs)(i.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05},className:"space-y-6",children:[(0,n.jsxs)("section",{className:"bg-[#0A0A0A] border border-white/5 rounded-[2rem] p-6",children:[(0,n.jsxs)("h2",{className:"text-xl font-black mb-5 flex items-center gap-2",children:[(0,n.jsx)(l.Z,{className:"w-5 h-5 text-accent-gold"})," اطلاعات پایه"]}),(0,n.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,n.jsx)(g,{icon:(0,n.jsx)(l.Z,{className:"w-4 h-4 text-white/40"}),label:"نام و نام خانوادگی",children:(0,n.jsx)("input",{value:j.fullName,onChange:e=>k(t=>({...t,fullName:e.target.value})),className:"input",placeholder:"مثال: علی محمدی"})}),(0,n.jsx)(g,{icon:(0,n.jsx)(l.Z,{className:"w-4 h-4 text-white/40"}),label:"نام کاربری",children:(0,n.jsx)("input",{value:j.username,onChange:e=>k(t=>({...t,username:e.target.value})),className:"input",placeholder:"مثال: ali_m"})}),(0,n.jsx)(g,{icon:(0,n.jsx)(s.Z,{className:"w-4 h-4 text-white/40"}),label:"شماره موبایل",children:(0,n.jsx)("input",{value:j.phone,onChange:e=>k(t=>({...t,phone:e.target.value})),className:"input",placeholder:"0912..."})}),(0,n.jsx)(g,{icon:(0,n.jsx)(c,{className:"w-4 h-4 text-white/40"}),label:"شهر",children:(0,n.jsx)("input",{value:j.city,onChange:e=>k(t=>({...t,city:e.target.value})),className:"input",placeholder:"تهران"})}),(0,n.jsx)(g,{icon:(0,n.jsx)(u,{className:"w-4 h-4 text-white/40"}),label:"لینک آواتار",children:(0,n.jsx)("input",{value:j.avatarUrl,onChange:e=>k(t=>({...t,avatarUrl:e.target.value})),className:"input",placeholder:"https://..."})}),(0,n.jsx)(g,{icon:(0,n.jsx)(d.Z,{className:"w-4 h-4 text-white/40"}),label:"ایمیل",children:(0,n.jsx)("input",{value:null!==(e=null==t?void 0:t.email)&&void 0!==e?e:"",className:"input opacity-60",disabled:!0})})]}),(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("label",{className:"text-xs text-white/50 mb-2 block",children:"آدرس"}),(0,n.jsx)("input",{value:j.address,onChange:e=>k(t=>({...t,address:e.target.value})),className:"input w-full",placeholder:"آدرس کامل"})]}),(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("label",{className:"text-xs text-white/50 mb-2 block",children:"بیو"}),(0,n.jsx)("textarea",{value:j.bio,onChange:e=>k(t=>({...t,bio:e.target.value})),className:"input w-full min-h-24",placeholder:"توضیح کوتاه درباره خودتان"})]})]}),(0,n.jsxs)("section",{className:"bg-[#0A0A0A] border border-white/5 rounded-[2rem] p-6",children:[(0,n.jsxs)("h2",{className:"text-xl font-black mb-5 flex items-center gap-2",children:[(0,n.jsx)(h.Z,{className:"w-5 h-5 text-accent-cyan"})," تنظیمات اعلان"]}),(0,n.jsxs)("div",{className:"grid md:grid-cols-3 gap-3",children:[(0,n.jsx)(b,{label:"ایمیل",checked:j.notificationPrefs.email,onChange:e=>k(t=>({...t,notificationPrefs:{...t.notificationPrefs,email:e}}))}),(0,n.jsx)(b,{label:"پیامک",checked:j.notificationPrefs.sms,onChange:e=>k(t=>({...t,notificationPrefs:{...t.notificationPrefs,sms:e}}))}),(0,n.jsx)(b,{label:"Push",checked:j.notificationPrefs.push,onChange:e=>k(t=>({...t,notificationPrefs:{...t.notificationPrefs,push:e}}))})]})]}),(0,n.jsxs)("section",{className:"bg-[#0A0A0A] border border-white/5 rounded-[2rem] p-6",children:[(0,n.jsxs)("h2",{className:"text-xl font-black mb-4 flex items-center gap-2",children:[(0,n.jsx)(f,{className:"w-5 h-5 text-rose-400"})," امنیت"]}),(0,n.jsx)("p",{className:"text-sm text-white/50 mb-4",children:"در نسخه بعدی: تغییر رمز عبور، خروج از همه دستگاه‌ها و تایید دو مرحله‌ای."}),(0,n.jsxs)("button",{onClick:A,disabled:w||o,className:"btn-primary w-full md:w-auto disabled:opacity-60",children:[(0,n.jsx)(m.Z,{className:"w-4 h-4"}),w?"در حال ذخیره...":"ذخیره تغییرات"]})]})]})]})]})}function g(e){let{label:t,icon:r,children:a}=e;return(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-xs text-white/50 mb-2 block",children:t}),(0,n.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-xl px-3 py-2 flex items-center gap-2",children:[r,(0,n.jsx)("div",{className:"flex-1",children:a})]})]})}function b(e){let{label:t,checked:r,onChange:a}=e;return(0,n.jsxs)("button",{type:"button",onClick:()=>a(!r),className:"p-4 rounded-xl border text-right transition ".concat(r?"border-accent-gold bg-accent-gold/10":"border-white/10 bg-white/5"),children:[(0,n.jsx)("p",{className:"font-bold",children:t}),(0,n.jsx)("p",{className:"text-xs text-white/50 mt-1",children:r?"فعال":"غیرفعال"})]})}},1837:function(e,t,r){"use strict";r.d(t,{Je:function(){return d},Nv:function(){return m},c8:function(){return p},hP:function(){return c},vD:function(){return u}});var n,a=r(257);let i=null!==(n=a.env.NEXT_PUBLIC_API_URL)&&void 0!==n?n:"http://localhost:4000/api/v1",l=a.env.NEXT_PUBLIC_API_GATEWAY_KEY,s="car_access_token",o="car_refresh_token";function c(){return localStorage.getItem(s)}function u(e){localStorage.setItem(s,e.accessToken),localStorage.setItem(o,e.refreshToken)}function d(){localStorage.removeItem(s),localStorage.removeItem(o)}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=new Headers(t.headers);void 0!==t.body&&null!==t.body&&n.set("Content-Type","application/json"),l&&n.set("x-api-gateway-key",l),r&&n.set("Authorization","Bearer ".concat(r));let a=await fetch("".concat(i).concat(e),{...t,headers:n});if(!a.ok){var s,o;let e=await a.json().catch(()=>({}));throw Error(null!==(o=null!==(s=e.error)&&void 0!==s?s:e.message)&&void 0!==o?o:"HTTP_".concat(a.status))}return 204===a.status?{}:await a.json()}async function f(){let e=localStorage.getItem(o);if(!e)return null;try{let t=await h("/auth/refresh",{method:"POST",body:JSON.stringify({refreshToken:e})});return u(t),t.accessToken}catch(e){return d(),null}}async function m(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{auth:!0},a=null===(t=n.auth)||void 0===t||t,i=a?c():void 0;try{return await h(e,r,null!=i?i:void 0)}catch(n){if(!a)throw n;let t=await f();if(!t)throw n;return h(e,r,t)}}function p(){return"undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():"idemp-".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2))}},7766:function(e,t,r){"use strict";r.d(t,{H:function(){return o},a:function(){return c}});var n=r(7437),a=r(2265),i=r(1837);let l=(0,a.createContext)(null);async function s(){return(0,i.Nv)("/me",{method:"GET"},{auth:!0})}function o(e){let{children:t}=e,[r,o]=(0,a.useState)(null),[c,u]=(0,a.useState)(!0),d=(0,a.useCallback)(async()=>{o(await s())},[]);(0,a.useEffect)(()=>{let e=!0;return(async()=>{try{let t=await s();e&&o(t)}catch(t){e&&o(null)}finally{e&&u(!1)}})(),()=>{e=!1}},[]);let h=(0,a.useCallback)(async e=>{let{email:t,password:r}=e,n=await (0,i.Nv)("/auth/login",{method:"POST",body:JSON.stringify({email:t,password:r})},{auth:!1});return(0,i.vD)({accessToken:n.accessToken,refreshToken:n.refreshToken}),o(n.user),n.user},[]),f=(0,a.useCallback)(async e=>{let{email:t,password:r,referralCode:n}=e;await (0,i.Nv)("/auth/register",{method:"POST",body:JSON.stringify({email:t,password:r,referralCode:n})},{auth:!1})},[]),m=(0,a.useCallback)(async()=>{try{let e=localStorage.getItem("car_refresh_token");e&&await (0,i.Nv)("/auth/logout",{method:"POST",body:JSON.stringify({refreshToken:e})})}catch(e){}finally{(0,i.Je)(),o(null)}},[]),p=(0,a.useMemo)(()=>({user:r,isLoading:c,isAuthenticated:!!r,login:h,register:f,logout:m,refreshMe:d}),[r,c,h,f,m,d]);return(0,n.jsx)(l.Provider,{value:p,children:t})}function c(){let e=(0,a.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}}},function(e){e.O(0,[5186,4072,2971,2117,1744],function(){return e(e.s=3536)}),_N_E=e.O()}]);