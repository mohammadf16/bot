(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4635],{1513:function(e,t,n){Promise.resolve().then(n.bind(n,4469))},257:function(e,t,n){"use strict";var r,s;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(s=n.g.process)?void 0:s.env)?n.g.process:n(4227)},4227:function(e){!function(){var t={229:function(e){var t,n,r,s=e.exports={};function a(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var c=[],o=!1,u=-1;function d(){o&&r&&(o=!1,r.length?c=r.concat(c):u=-1,c.length&&h())}function h(){if(!o){var e=l(d);o=!0;for(var t=c.length;t;){for(r=c,c=[];++u<t;)r&&r[u].run();u=-1,t=c.length}r=null,o=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||o||l(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},n={};function r(e){var s=n[e];if(void 0!==s)return s.exports;var a=n[e]={exports:{}},i=!0;try{t[e](a,a.exports,r),i=!1}finally{i&&delete n[e]}return a.exports}r.ab="//";var s=r(229);e.exports=s}()},4469:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var r=n(7437),s=n(2265),a=n(5186),i=n(1837),l=n(7766);function c(){var e,t,n,c;let{user:o,refreshMe:u}=(0,l.a)(),[d,h]=(0,s.useState)(null),[f,m]=(0,s.useState)(null),[x,p]=(0,s.useState)([]),[v,y]=(0,s.useState)(!1);async function g(){try{let[e,t]=await Promise.all([(0,i.Nv)("/slide/single/today",{method:"GET"},{auth:!1}),(0,i.Nv)("/slide/battle/rooms",{method:"GET"},{auth:!1})]);h(e),p(t.items)}catch(e){a.ZP.error(e instanceof Error?e.message:"خطا در دریافت اطلاعات")}}async function b(e){y(!0);try{let t=await (0,i.Nv)("/slide/single/spin",{method:"POST",body:JSON.stringify({stakeType:e})});m(t),await u(),a.ZP.success(t.win?"تبریک! برنده شدی":"این بار نشد")}catch(e){a.ZP.error(e instanceof Error?e.message:"چرخش انجام نشد")}finally{y(!1)}}async function N(e){y(!0);try{await (0,i.Nv)("/slide/battle/join",{method:"POST",body:JSON.stringify({entryAsset:e,entryAmount:"CHANCE"===e?5:1e4,maxPlayers:10})}),await u(),await g(),a.ZP.success("وارد اتاق شدی")}catch(e){a.ZP.error(e instanceof Error?e.message:"ورود به اتاق ناموفق بود")}finally{y(!1)}}return(0,s.useEffect)(()=>{g()},[]),(0,r.jsx)("main",{className:"min-h-screen pt-28 pb-20",dir:"rtl",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto px-4 space-y-8",children:[(0,r.jsxs)("section",{className:"card glass p-8",children:[(0,r.jsx)("h1",{className:"text-4xl font-black mb-3",children:"بازی ماشین اسلاید"}),(0,r.jsx)("p",{className:"text-white/70",children:"حالت A: تک‌نفره روزانه | حالت B: اتاق گروهی Battle"})]}),(0,r.jsxs)("section",{className:"grid md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"card glass p-6 space-y-4",children:[(0,r.jsx)("h2",{className:"text-2xl font-black",children:"حالت A: تک‌نفره"}),(0,r.jsxs)("p",{className:"text-sm text-white/70",children:["عدد هدف امروز: ",(null==d?void 0:d.hasTarget)?null==d?void 0:d.targetNumber:"تنظیم نشده"]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{disabled:v,onClick:()=>b("chance"),className:"btn-primary flex-1",children:"چرخش با ۱ شانس"}),(0,r.jsx)("button",{disabled:v,onClick:()=>b("irr"),className:"btn-secondary flex-1",children:"چرخش با ۱۰,۰۰۰ تومان"})]}),f?(0,r.jsxs)("div",{className:"rounded-xl border border-white/10 bg-black/20 p-4 text-sm",children:[(0,r.jsxs)("p",{children:["عدد شما: ",(0,r.jsx)("b",{children:f.rolledNumber})]}),(0,r.jsxs)("p",{children:["عدد برنده: ",(0,r.jsx)("b",{children:f.targetNumber})]}),(0,r.jsxs)("p",{children:["وضعیت: ",(0,r.jsx)("b",{children:f.win?"برنده":"بازنده"})]}),f.reward?(0,r.jsxs)("p",{children:["جایزه: ",f.reward.toLocaleString("fa-IR")," تومان"]}):null]}):null]}),(0,r.jsxs)("div",{className:"card glass p-6 space-y-4",children:[(0,r.jsx)("h2",{className:"text-2xl font-black",children:"حالت B: Battle Room"}),(0,r.jsx)("p",{className:"text-sm text-white/70",children:"ورودی ۵ شانس یا ۱۰,۰۰۰ تومان، ۱۰ نفره، برنده پات را می‌گیرد."}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{disabled:v,onClick:()=>N("CHANCE"),className:"btn-primary flex-1",children:"ورود با شانس"}),(0,r.jsx)("button",{disabled:v,onClick:()=>N("IRR"),className:"btn-secondary flex-1",children:"ورود با تومان"})]})]})]}),(0,r.jsxs)("section",{className:"card glass p-6",children:[(0,r.jsx)("h3",{className:"text-xl font-black mb-3",children:"اتاق‌های بازی"}),(0,r.jsxs)("div",{className:"space-y-2",children:[x.map(e=>(0,r.jsxs)("div",{className:"rounded-lg border border-white/10 bg-black/20 p-3 text-sm",children:[(0,r.jsxs)("p",{children:["اتاق: ",e.id]}),(0,r.jsxs)("p",{children:["وضعیت: ",e.status]}),(0,r.jsxs)("p",{children:["ورودی: ",e.entryAmount," ",e.entryAsset]}),(0,r.jsxs)("p",{children:["بازیکن: ",e.players.length,"/",e.maxPlayers]}),"finished"===e.status?(0,r.jsxs)("p",{children:["برنده: ",e.winnerUserId]}):null]},e.id)),x.length?null:(0,r.jsx)("p",{className:"text-white/60",children:"اتاقی وجود ندارد."})]})]}),(0,r.jsxs)("section",{className:"card glass p-6 text-sm text-white/70",children:[(0,r.jsxs)("p",{children:["موجودی تومان: ",null!==(n=null==o?void 0:null===(e=o.walletBalance)||void 0===e?void 0:e.toLocaleString("fa-IR"))&&void 0!==n?n:0]}),(0,r.jsxs)("p",{children:["شانس: ",null!==(c=null==o?void 0:null===(t=o.chances)||void 0===t?void 0:t.toLocaleString("fa-IR"))&&void 0!==c?c:0]})]})]})})}},1837:function(e,t,n){"use strict";n.d(t,{Je:function(){return d},Nv:function(){return m},c8:function(){return x},hP:function(){return o},vD:function(){return u}});var r,s=n(257);let a=null!==(r=s.env.NEXT_PUBLIC_API_URL)&&void 0!==r?r:"http://localhost:4000/api/v1",i=s.env.NEXT_PUBLIC_API_GATEWAY_KEY,l="car_access_token",c="car_refresh_token";function o(){return localStorage.getItem(l)}function u(e){localStorage.setItem(l,e.accessToken),localStorage.setItem(c,e.refreshToken)}function d(){localStorage.removeItem(l),localStorage.removeItem(c)}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=new Headers(t.headers);void 0!==t.body&&null!==t.body&&r.set("Content-Type","application/json"),i&&r.set("x-api-gateway-key",i),n&&r.set("Authorization","Bearer ".concat(n));let s=await fetch("".concat(a).concat(e),{...t,headers:r});if(!s.ok){var l,c;let e=await s.json().catch(()=>({}));throw Error(null!==(c=null!==(l=e.error)&&void 0!==l?l:e.message)&&void 0!==c?c:"HTTP_".concat(s.status))}return 204===s.status?{}:await s.json()}async function f(){let e=localStorage.getItem(c);if(!e)return null;try{let t=await h("/auth/refresh",{method:"POST",body:JSON.stringify({refreshToken:e})});return u(t),t.accessToken}catch(e){return d(),null}}async function m(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{auth:!0},s=null===(t=r.auth)||void 0===t||t,a=s?o():void 0;try{return await h(e,n,null!=a?a:void 0)}catch(r){if(!s)throw r;let t=await f();if(!t)throw r;return h(e,n,t)}}function x(){return"undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():"idemp-".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2))}},7766:function(e,t,n){"use strict";n.d(t,{H:function(){return c},a:function(){return o}});var r=n(7437),s=n(2265),a=n(1837);let i=(0,s.createContext)(null);async function l(){return(0,a.Nv)("/me",{method:"GET"},{auth:!0})}function c(e){let{children:t}=e,[n,c]=(0,s.useState)(null),[o,u]=(0,s.useState)(!0),d=(0,s.useCallback)(async()=>{c(await l())},[]);(0,s.useEffect)(()=>{let e=!0;return(async()=>{try{let t=await l();e&&c(t)}catch(t){e&&c(null)}finally{e&&u(!1)}})(),()=>{e=!1}},[]);let h=(0,s.useCallback)(async e=>{let{email:t,password:n}=e,r=await (0,a.Nv)("/auth/login",{method:"POST",body:JSON.stringify({email:t,password:n})},{auth:!1});return(0,a.vD)({accessToken:r.accessToken,refreshToken:r.refreshToken}),c(r.user),r.user},[]),f=(0,s.useCallback)(async e=>{let{email:t,password:n,referralCode:r}=e;await (0,a.Nv)("/auth/register",{method:"POST",body:JSON.stringify({email:t,password:n,referralCode:r})},{auth:!1})},[]),m=(0,s.useCallback)(async()=>{try{let e=localStorage.getItem("car_refresh_token");e&&await (0,a.Nv)("/auth/logout",{method:"POST",body:JSON.stringify({refreshToken:e})})}catch(e){}finally{(0,a.Je)(),c(null)}},[]),x=(0,s.useMemo)(()=>({user:n,isLoading:o,isAuthenticated:!!n,login:h,register:f,logout:m,refreshMe:d}),[n,o,h,f,m,d]);return(0,r.jsx)(i.Provider,{value:x,children:t})}function o(){let e=(0,s.useContext)(i);if(!e)throw Error("useAuth must be used within AuthProvider");return e}}},function(e){e.O(0,[5186,2971,2117,1744],function(){return e(e.s=1513)}),_N_E=e.O()}]);